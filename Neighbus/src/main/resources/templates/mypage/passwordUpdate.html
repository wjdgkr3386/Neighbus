<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Neighbus - 비밀번호 변경</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    
    <style>
        /* 화면 전체를 갈색으로 채우고 내용물을 정중앙에 배치 */
        .body-bg {
            background-color: #8D6E63; /* 코코아색 */
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
        }
        /* 폼 컨테이너 스타일 */
        .form-container {
            background-color: white;
            padding: 3rem;
            border-radius: 1rem;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            width: 100%;
            max-width: 600px; /* 최대 너비 제한 */
        }
    </style>
</head>
<body>

    <div class="body-bg">
        <div class="container d-flex justify-content-center">
            
            <div class="form-container">
                <h1 class="text-center mb-5 fw-bold">Neighbus</h1>
                
                <form id="updateForm" action="/mypage/updatePasswordProc" method="POST">
                    <div class="mb-3">
                        <label for="password" class="form-label">새로운 비밀번호</label>
                        <input type="password" class="form-control form-control-lg" id="password" name="password" placeholder="영문+숫자 8~20자">
                        <div id="passwordHelp" class="form-text text-secondary">
                        </div>
                    </div>

                    <div class="mb-4">
                        <label for="passwordCheck" class="form-label">비밀번호 확인</label>
                        <input type="password" class="form-control form-control-lg" id="passwordCheck" name="passwordCheck" placeholder="비밀번호를 다시 입력하세요.">
                        <div id="passwordCheckHelp" class="form-text text-danger"></div>
                    </div>

                    <div class="d-grid gap-2 d-md-block text-end">
                        <button type="button" class="btn btn-secondary me-md-2" onclick="history.back()">취소</button>
                        <button type="submit" class="btn btn-success" id="submitBtn" disabled>변경</button>
                    </div>
                </form>
            </div>

        </div>
    </div>

    <script>
        const updateForm = document.getElementById('updateForm');
        const pwdInput = document.getElementById('password');
        const pwdCheckInput = document.getElementById('passwordCheck');
        const submitBtn = document.getElementById('submitBtn');
        
        const pwdHelp = document.getElementById('passwordHelp');
        const pwdCheckHelp = document.getElementById('passwordCheckHelp');

        // 정규식: 영문, 숫자 포함 8~20자
        const pwdRegex = /^(?=.*[a-zA-Z])(?=.*[0-9])[a-zA-Z0-9]{8,20}$/;

        // 성공/실패 메시지 표시 함수
        function setStatus(input, helpText, isValid, msg) {
            if (isValid) {
                input.classList.remove('is-invalid');
                input.classList.add('is-valid');
                helpText.classList.remove('text-danger', 'text-secondary');
                helpText.classList.add('text-success');
            } else {
                input.classList.remove('is-valid');
                input.classList.add('is-invalid');
                helpText.classList.remove('text-success', 'text-secondary');
                helpText.classList.add('text-danger');
            }
            helpText.textContent = msg;
        }

        // 버튼 활성화 여부 결정 함수
        function validateButton() {
            const isPwdValid = pwdRegex.test(pwdInput.value);
            const isMatch = (pwdInput.value === pwdCheckInput.value && pwdInput.value !== "");

            if (isPwdValid && isMatch) {
                submitBtn.disabled = false;
            } else {
                submitBtn.disabled = true;
            }
        }

        // 비밀번호 입력 시 검사
        pwdInput.addEventListener('keyup', function() {
            const val = pwdInput.value;
            
            if (pwdRegex.test(val)) {
                setStatus(pwdInput, pwdHelp, true, "사용 가능한 비밀번호입니다.");
            } else {
                setStatus(pwdInput, pwdHelp, false, "8~20자의 영문+숫자 조합이어야 합니다.");
            }
            
            // 비밀번호를 고치면 확인란도 다시 비교
            if(pwdCheckInput.value !== "") checkMatch();
            validateButton();
        });

        // 비밀번호 확인 입력 시 검사
        pwdCheckInput.addEventListener('keyup', function() {
            checkMatch();
            validateButton();
        });

        function checkMatch() {
            if (pwdInput.value === pwdCheckInput.value) {
                setStatus(pwdCheckInput, pwdCheckHelp, true, "비밀번호가 일치합니다.");
            } else {
                setStatus(pwdCheckInput, pwdCheckHelp, false, "비밀번호가 서로 맞지 않습니다.");
            }
        }

    </script>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>