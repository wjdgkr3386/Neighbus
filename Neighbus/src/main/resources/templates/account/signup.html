<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>회원가입 - 동네친구</title>
    <link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        /* 스타일은 이전과 동일 */
        :root {
            --primary-color: #7C3AED;
            --primary-color-light: #A78BFA;
            --accent-color: #F97316;
            --background-color: #F8FAFC;
            --text-primary: #1E293B;
            --text-secondary: #64748B;
            --border-color: #E2E8F0;
            --card-bg: #FFFFFF;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
            color: #1E293B;
            min-height: 100vh;
            background: #FFFFFF;
            overflow-x: hidden;  
        }
        .signup-container {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 60px 20px;
            min-height: 100vh;
        }
        .signup-form-wrapper {
            width: 100%;
            max-width: 800px;
            text-align: center;
            animation: fadeInSlideUp 1s ease-out;
        }
        @keyframes fadeInSlideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .signup-form-wrapper h2 {
            font-size: 32px;
            font-weight: 700;
            line-height: 1.4;
            margin-bottom: 15px;
            color: #1E293B;
        }
        .signup-form-wrapper .subtitle {
            color: #64748B;
            font-size: 16px;
            margin-bottom: 50px;
        }
        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px 25px;
        }
        .form-group {
            text-align: left;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .form-group.full-width { grid-column: 1 / -1; }
        .form-group label { font-size: 14px; font-weight: 600; color: #1E293B; }
        .error-message {
            font-size: 12px;
            color: #EF4444;
            margin-top: 2px;
            display: none;
        }
        .error-message.show { display: block; }
        .success-message {
            font-size: 12px;
            color: #10B981;
            margin-top: 2px;
            display: none;
        }
        .success-message.show { display: block; }
        .form-group input, .form-group select {
            width: 100%;
            background: #F8FAFC;
            border: 1px solid #E2E8F0;
            border-radius: 14px;
            padding: 16px 20px;
            font-size: 16px;
            color: #1E293B;
            font-family: 'Pretendard', sans-serif;
            transition: all 0.3s ease;
        }
        .form-group input.error { border-color: #EF4444; background: #FEF2F2; }
        .form-group input.success { border-color: #10B981; background: #F0FDF4; }
        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: var(--accent-color);
            background: #FFFFFF;
            box-shadow: 0 0 0 3px rgba(249, 115, 22, 0.1);
        }
        .form-group select {
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3E%3Cpath stroke='%231E293B' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 1rem center;
            cursor: pointer;
        }
        .region-select-group { display: flex; gap: 12px; }
        .region-select-group select { flex: 1; min-width: 0; }
        .gender-group { display: flex; gap: 12px; }
        .gender-option {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 16px 20px;
            border: 1px solid #E2E8F0;
            border-radius: 14px;
            cursor: pointer;
            transition: all 0.3s;
            background: #F8FAFC;
        }
        .gender-option:hover { border-color: var(--accent-color); background: #FFFFFF; }
        .gender-option input[type="radio"] { width: 18px; height: 18px; cursor: pointer; accent-color: var(--accent-color); }
        .gender-option label { cursor: pointer; margin: 0; font-size: 16px; font-weight: 500; color: #1E293B; }
        .gender-option input[type="radio"]:checked + label { color: var(--accent-color); font-weight: 600; }
        .gender-option:has(input[type="radio"]:checked) { border-color: var(--accent-color); background: #FFF7ED; box-shadow: 0 0 0 3px rgba(249, 115, 22, 0.1); }
        .btn-submit {
            width: 100%;
            padding: 18px;
            border-radius: 12px;
            background: var(--accent-color);
            color: white;
            font-weight: 700;
            font-size: 17px;
            cursor: pointer;
            border: none;
            transition: all 0.3s;
            margin-top: 10px;
            grid-column: 1 / -1;
        }
        .btn-submit:hover { transform: translateY(-2px); background: #EA580C; box-shadow: 0 8px 20px rgba(249, 115, 22, 0.3); }
        .btn-submit:active { transform: translateY(0); }
        .form-footer { margin-top: 30px; font-size: 14px; color: #64748B; }
        .form-footer a { color: #1E293B; text-decoration: none; font-weight: 500; transition: color 0.3s; }
        .form-footer a:hover { color: #64748B; }
        @media (max-width: 768px) {
            .signup-container { padding: 40px 20px; }
            .form-grid { grid-template-columns: 1fr; gap: 18px; }
            .signup-form-wrapper h2 { font-size: 28px; }
            .signup-form-wrapper .subtitle { font-size: 15px; margin-bottom: 40px; }
            .region-select-group { gap: 10px; }
            .gender-group { gap: 8px; }
            .gender-option { padding: 14px 16px; }
            .gender-option label { font-size: 15px; }
            .btn-submit { padding: 16px; font-size: 16px; }
        }
        @media (max-width: 480px) {
            .signup-container { padding: 30px 15px; }
            .signup-form-wrapper h2 { font-size: 24px; }
            .form-group input, .form-group select { padding: 14px 16px; font-size: 15px; }
        }
    </style>
</head>
<body>

<main class="signup-container">
    <div class="signup-form-wrapper">
        <h2>동네친구가 처음이신가요?</h2>
        <p class="subtitle">몇 가지 정보만 입력하고 새로운 친구들을 만나보세요.</p>
        
        <form id="signupForm">
            <div class="form-grid">
                <div class="form-group">
                    <label for="name">이름</label>
                    <input type="text" id="name" name="name" placeholder="이름을 입력하세요" required>
                </div>
				<div class="form-group">
				    <label for="username">아이디</label>
				    <input type="text" id="username" name="username" placeholder="아이디를 입력하세요" required>
				    <p class="error-message" id="username-error">이미 존재하는 아이디입니다.</p>
				</div>
                <div class="form-group">
                    <label for="password">비밀번호</label>
                    <input type="password" id="password" name="password" placeholder="비밀번호를 입력하세요" required>
                </div>
                <div class="form-group">
                    <label for="passwordConfirm">비밀번호 확인</label>
                    <input type="password" id="passwordConfirm" name="passwordConfirm" placeholder="비밀번호를 다시 입력하세요" required>
                    <p class="error-message" id="password-error">비밀번호가 일치하지 않습니다.</p>
                    <p class="success-message" id="password-success">비밀번호가 일치합니다.</p>
                </div>
                <div class="form-group">
                    <label for="birth">생년월일</label>
                    <input type="date" id="birth" name="birth" required>
                </div>
                <div class="form-group">
                    <label>성별</label>
                    <div class="gender-group">
                        <div class="gender-option">
                            <input type="radio" id="sexM" name="sex" value="M" required>
                            <label for="sexM">남성</label>
                        </div>
                        <div class="gender-option">
                            <input type="radio" id="sexF" name="sex" value="F" required>
                            <label for="sexF">여성</label>
                        </div>
                    </div>
                </div>
                <div class="form-group full-width">
                    <label for="province">시/도</label>
                    <div class="region-select-group">
                        <select id="province" name="province" required>
                            <option value="" disabled selected>시/도 선택</option>
                            <option th:each="province : ${provinceList}" 
                                    th:value="${province.id}" 
                                    th:text="${province.province}"></option>
                        </select>
                        <select id="city" name="city" required disabled>
                            <option value="" disabled selected>시/군/구 선택</option>
                        </select>
                    </div>
                </div>
                <div class="form-group full-width">
                    <label for="address">상세주소</label>
                    <input type="text" id="address" name="address" placeholder="상세주소를 입력하세요" required>
                </div>
                <div class="form-group">
                    <label for="phone">전화번호</label>
                    <input type="tel" id="phone" name="phone" placeholder="010-1234-5678" maxlength="13" required>
                    <p class="error-message" id="phone-error">올바른 전화번호 형식이 아닙니다.</p>
                </div>
                <div class="form-group">
                    <label for="email">이메일</label>
                    <input type="email" id="email" name="email" placeholder="example@email.com" required>
                    <p class="error-message" id="email-error">올바른 이메일 형식이 아닙니다.</p>
                </div>
                <button type="submit" class="btn-submit">회원가입 완료</button>
            </div>
        </form>

        <div class="form-footer">
            <p>이미 계정이 있으신가요? <a href="login">로그인하기</a></p>
        </div>
    </div>
</main>

<script th:inline="javascript">
    const provinceSelect = document.getElementById('province');
    const citySelect = document.getElementById('city');
    const regionList = /*[[${regionList}]]*/ null;

    provinceSelect.addEventListener('change', function() {
        const selectedValue = parseInt(this.value, 10);
        citySelect.innerHTML = '<option value="" disabled selected>시/군/구 선택</option>';
        if(regionList && selectedValue){
            for(let i=0;i<regionList.length;i++){
                if(selectedValue === regionList[i].province){
                    const option = document.createElement('option');
                    option.value = regionList[i].id; 
                    option.textContent = regionList[i].city;
                    citySelect.appendChild(option);
                }
            }
            citySelect.disabled = false;
        } else {
            citySelect.disabled = true;
        }
    });

    const password = document.getElementById('password');
    const passwordConfirm = document.getElementById('passwordConfirm');
    const passwordError = document.getElementById('password-error');
    const passwordSuccess = document.getElementById('password-success');

    function validatePassword() {
        if (passwordConfirm.value === '') {
            passwordConfirm.classList.remove('error','success');
            passwordError.classList.remove('show');
            passwordSuccess.classList.remove('show');
            return true;
        }
        if(password.value !== passwordConfirm.value){
            passwordConfirm.classList.add('error');
            passwordConfirm.classList.remove('success');
            passwordError.classList.add('show');
            passwordSuccess.classList.remove('show');
            return false;
        } else {
            passwordConfirm.classList.add('success');
            passwordConfirm.classList.remove('error');
            passwordSuccess.classList.add('show');
            passwordError.classList.remove('show');
            return true;
        }
    }

    password.addEventListener('input', validatePassword);
    passwordConfirm.addEventListener('input', validatePassword);

    const phone = document.getElementById('phone');
    const phoneError = document.getElementById('phone-error');

    function formatPhoneNumber(value){
        const numbers = value.replace(/[^\d]/g,'');
        if(numbers.length <=3) return numbers;
        if(numbers.length <=7) return numbers.slice(0,3)+'-'+numbers.slice(3);
        if(numbers.length <=10) return numbers.slice(0,3)+'-'+numbers.slice(3,6)+'-'+numbers.slice(6);
        return numbers.slice(0,3)+'-'+numbers.slice(3,7)+'-'+numbers.slice(7,11);
    }

    function validatePhone(){
        const numbers = phone.value.replace(/[^\d]/g,'');
        const phonePattern = /^01[0-9]\d{7,8}$/;
        if(phone.value === ''){
            phone.classList.remove('error','success');
            phoneError.classList.remove('show');
            return true;
        }
        if(!phonePattern.test(numbers)){
            phone.classList.add('error');
            phone.classList.remove('success');
            phoneError.classList.add('show');
            return false;
        } else {
            phone.classList.add('success');
            phone.classList.remove('error');
            phoneError.classList.remove('show');
            return true;
        }
    }

    phone.addEventListener('input',function(e){
        e.target.value = formatPhoneNumber(e.target.value);
        validatePhone();
    });
    phone.addEventListener('blur', validatePhone);

    const email = document.getElementById('email');
    const emailError = document.getElementById('email-error');

    function validateEmail(){
        const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if(email.value === ''){
            email.classList.remove('error','success');
            emailError.classList.remove('show');
            return true;
        }
        if(!emailPattern.test(email.value)){
            email.classList.add('error');
            email.classList.remove('success');
            emailError.classList.add('show');
            return false;
        } else {
            email.classList.add('success');
            email.classList.remove('error');
            emailError.classList.remove('show');
            return true;
        }
    }

    email.addEventListener('input', validateEmail);
    email.addEventListener('blur', validateEmail);

    const signupForm = document.getElementById('signupForm');

    function signupProc(event){
        if(!validatePassword() || !validatePhone() || !validateEmail()){
            alert('입력된 정보를 다시 확인해주세요.');
            return;
        }

        const requiredFields = Array.from(signupForm.querySelectorAll('[required]'));
        let allFilled = true;
        for(const field of requiredFields){
            if(!field.value && field.type !== 'radio'){ allFilled=false; break;}
            if(field.type==='radio'){
                const radioGroup = document.querySelectorAll(`[name="${field.name}"]`);
                const isChecked = Array.from(radioGroup).some(radio=>radio.checked);
                if(!isChecked){ allFilled=false; break;}
            }
        }
        if(!allFilled){ alert('모든 필수 항목을 입력해주세요.'); return; }
        
        const name = document.getElementById('name');
        const username = document.getElementById('username');
        const pwd = document.getElementById('password');
        const birth = document.getElementById('birth');
        const province = document.getElementById('province');
        const city = document.getElementById('city');
        const address = document.getElementById('address');
        const phone = document.getElementById('phone');
        const email = document.getElementById('email');
        const gender = document.querySelector('input[name="sex"]:checked');

        const usernameError = document.getElementById('username-error');
        const usernameInput = document.getElementById('username');
        
        fetch("/insertSignup",{
            method:"POST",
            headers: { "Content-Type":"application/json" },
            body: JSON.stringify({
                name: name.value.trim(),
                username: username.value.trim(),
                password: pwd.value.trim(),
                birth: birth.value.replace(/-/g,'').slice(2), 
                sex: gender.value,
                province: parseInt(province.value),
                city: parseInt(city.value),
                address: address.value.trim(),
                phone: phone.value.replace(/[^\d]/g,''),
                email: email.value.trim()
            })
        }).then(res=>res.json())
        .then(data=>{
            if(data.status === 1){
            	location.replace("/account/login");
            }else if(data.status === -2){
                usernameInput.classList.add('error');
                usernameError.classList.add('show');
                usernameError.textContent = "이미 존재하는 아이디입니다.";
                usernameInput.focus();
            }else if(data.status === -3){
                phone.classList.add('error');
                phoneError.classList.add('show');
                phoneError.textContent = "이미 존재하는 전화번호입니다.";
                phone.focus();
            }else if(data.status === -4){
                email.classList.add('error');
                emailError.classList.add('show');
                emailError.textContent = "이미 존재하는 이메일입니다.";
                email.focus();
            }else{
            	alert("오류입니다. 관리자에게 문의 주세요.");
            }
        })
        .catch(err=>{ console.error(err); alert('서버 오류'); });
    }

    signupForm.addEventListener('submit', function(e){
        e.preventDefault();
        signupProc(e);
    });
</script>

</body>
</html>
