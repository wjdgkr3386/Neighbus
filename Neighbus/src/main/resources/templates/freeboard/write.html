<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>게시글 작성</title>
    <link href="https://cdn.jsdelivr.net/gh/sunn-us/SUIT/fonts/static/woff2/SUIT.css" rel="stylesheet">
    <link href="//fonts.googleapis.com/earlyaccess/nanumgothic.css" rel="stylesheet" type="text/css">
    <link href="https://cdn.jsdelivr.net/gh/moonspam/NanumSquare@2.0/nanumsquare.css" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    
    <style>
        :root {
            --primary: #A67C52;
            --primary-dark: #8D6E63;
            --primary-light: #C9A88A;
            --bg-ivory: #FFF8F0;
            --bg-warm: #FFF5EB;
            --bg-cream: #FAF0E6;
            --card-bg: #FFFBF7;
            --text-primary: #5D4037;
            --text-secondary: #8D6E63;
            --text-light: #A1887F;
            --border-color: #E8D7C3;
            --shadow-color: rgba(166, 124, 82, 0.15);
            --white: #FFFFFF;
            --accent-green: #7BA372;
            --accent-red: #C87E7E;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            margin: 0;
            padding: 100px 0 60px;
            max-width: 100%;
            overflow-x: hidden;
            font-family: 'SUIT', 'NanumSquare', -apple-system, sans-serif;
            background: linear-gradient(165deg, var(--bg-ivory) 0%, var(--bg-warm) 50%, var(--bg-cream) 100%);
            min-height: 100vh;
        }

        .form-wrapper {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 40px;
        }

        .contentForm {
            background: var(--card-bg) !important;
            border-radius: 24px;
            box-shadow: 0 8px 24px rgba(166, 124, 82, 0.12), 0 2px 8px rgba(166, 124, 82, 0.08);
            padding: 3.5rem !important;
            border: 1px solid var(--border-color);
            position: relative;
            overflow: hidden;
            width: 100%;
            max-width: 100%;
        }

        .contentForm::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary) 0%, var(--primary-light) 50%, var(--primary) 100%);
        }

        .form-title {
            text-align: center;
            font-size: 2rem;
            font-weight: 800;
            color: var(--text-primary);
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 2px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
        }

        .form-title i {
            color: var(--primary);
            font-size: 1.8rem;
        }

        .savebar {
            display: none;
        }

        /* 입력 그룹 래퍼 (수정됨) */
        .input-wrapper {
            width: 100%;
            display: flex;
            gap: 12px;
            margin-bottom: 1.5rem;
        }

        .input-group-custom {
            position: relative;
            flex: 1;
        }

        .input-group-custom.club-select {
            min-width: 200px;
            max-width: 220px;
        }

        .input-label {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .input-label i {
            color: var(--primary);
            font-size: 1rem;
        }

        #clubSelect {
            width: 100%;
            height: 52px;
            border: 2px solid var(--border-color);
            border-radius: 12px;
            padding: 0 38px 0 16px;
            font-size: 15px;
            appearance: none;
            background-color: var(--white);
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23A67C52' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 14px center;
            background-size: 18px;
            cursor: pointer;
            color: var(--text-primary);
            font-weight: 500;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(166, 124, 82, 0.05);
        }
        #clubSelect:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(166, 124, 82, 0.15), 0 2px 8px rgba(166, 124, 82, 0.1);
        }

        .title {
            width: 100%;
            height: 52px;
            border-radius: 12px;
            padding: 14px 18px;
            background-color: var(--white);
            border: 2px solid var(--border-color);
            font-size: 18px;
            outline: none;
            color: var(--text-primary);
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(166, 124, 82, 0.05);
        }
        .title:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(166, 124, 82, 0.15), 0 2px 8px rgba(166, 124, 82, 0.1);
        }
        .title::placeholder {
            color: var(--text-light);
            font-weight: 500;
        }

        .toolbar {
            margin: 24px 0;
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: nowrap;
            border: none;
            border-radius: 16px;
            background: linear-gradient(135deg, var(--card-bg) 0%, var(--bg-cream) 100%);
            padding: 18px 24px !important;
            box-shadow: 0 2px 12px rgba(166, 124, 82, 0.08);
            justify-content: flex-start;
            overflow-x: auto;
            overflow-y: hidden;
            -webkit-overflow-scrolling: touch;
        }

        .toolbar::-webkit-scrollbar {
            height: 8px;
        }

        .toolbar::-webkit-scrollbar-track {
            background: var(--bg-warm);
            border-radius: 4px;
        }

        .toolbar::-webkit-scrollbar-thumb {
            background: var(--primary-light);
            border-radius: 4px;
            transition: background 0.3s ease;
        }

        .toolbar::-webkit-scrollbar-thumb:hover {
            background: var(--primary);
        }

        .toolbar-group {
            display: flex;
            gap: 6px;
            padding: 8px 12px;
            background: var(--white);
            border-radius: 10px;
            border: 1px solid var(--border-color);
            align-items: center;
            flex-wrap: nowrap;
            flex-shrink: 0;
        }

        .toolbar-divider {
            width: 1px;
            height: 32px;
            background: var(--border-color);
            margin: 0 4px;
            flex-shrink: 0;
        }

        .toolbar .tool {
            flex-shrink: 0;
        }

        .toolbarHeader {
            width: 100%;
            min-height: 70px;
            height: auto;
            display: none;
            align-items: center;
            gap: 10px;
            position: fixed;
            top: 0;
            left: 0;
            background: linear-gradient(to bottom, var(--card-bg) 0%, rgba(255, 251, 247, 0.98) 100%);
            backdrop-filter: blur(10px);
            z-index: 1000;
            padding: 15px 20px !important;
            flex-wrap: nowrap;
            box-shadow: 0 4px 20px rgba(166, 124, 82, 0.12);
            border-bottom: 1px solid var(--border-color);
            justify-content: flex-start;
            overflow-x: auto;
            overflow-y: hidden;
            -webkit-overflow-scrolling: touch;
        }

        .toolbarHeader::-webkit-scrollbar {
            height: 6px;
        }

        .toolbarHeader::-webkit-scrollbar-track {
            background: rgba(255, 245, 235, 0.5);
            border-radius: 3px;
        }

        .toolbarHeader::-webkit-scrollbar-thumb {
            background: var(--primary-light);
            border-radius: 3px;
        }

        .toolbarHeader::-webkit-scrollbar-thumb:hover {
            background: var(--primary);
        }

        .toolbarHeader .toolbar-group {
            background: var(--white);
            border-radius: 10px;
            border: 1px solid var(--border-color);
            padding: 8px 12px;
            gap: 6px;
            flex-shrink: 0;
            flex-wrap: nowrap;
        }

        .toolbarHeader .toolbar-divider {
            width: 1px;
            height: 32px;
            background: var(--border-color);
            margin: 0 4px;
            flex-shrink: 0;
        }

        .toolbarHeader .tool {
            flex-shrink: 0;
        }

        .tool {
            height: 38px;
            min-width: 38px;
            font-size: 13px;
            background: var(--white);
            border: 1px solid var(--border-color);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            border-radius: 8px;
            padding: 0 12px;
            color: var(--text-primary);
            font-weight: 600;
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        .tool:hover {
            background: var(--primary);
            color: var(--white);
            border-color: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(166, 124, 82, 0.2);
        }
        .tool:active {
            transform: translateY(0);
        }
        .tool i {
            font-size: 14px;
        }

        /* 색상 버튼 특별 스타일 */
        .tool[title*="색상"] {
            background: linear-gradient(135deg, #fff 0%, #f8f8f8 100%);
            border: 2px solid var(--border-color);
            position: relative;
        }
        .tool[title*="색상"]:hover {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            border-color: var(--primary-dark);
        }
        .tool[title*="색상"] i {
            font-size: 15px;
        }

        .editor-wrapper {
            position: relative;
        }

        .editor-label {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .editor-label i {
            color: var(--primary);
            font-size: 1rem;
        }

        .editor {
            box-sizing: border-box;
            width: 100%;
            min-height: 500px;
            padding: 24px;
            font-size: 16px;
            outline: none;
            border: 2px solid var(--border-color);
            border-radius: 12px;
            background: var(--white);
            color: var(--text-primary);
            line-height: 1.8;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(166, 124, 82, 0.05);
        }
        .editor:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(166, 124, 82, 0.15), 0 2px 8px rgba(166, 124, 82, 0.1);
        }
        .editor:empty:before {
            content: attr(placeholder);
            color: var(--text-light);
            font-weight: 400;
        }
        .editor img {
            max-width: 100%;
            display: block;
            margin: 15px 0;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        select.tool {
            padding-right: 28px;
            -webkit-appearance: none;
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%235D4037' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 8px center;
            background-size: 12px;
        }

        /* 대형 화면 (1200px 이상) 최적화 */
        @media screen and (min-width: 1200px) {
            .toolbar {
                gap: 12px;
                padding: 20px 28px !important;
            }

            .toolbar::-webkit-scrollbar {
                height: 10px;
            }

            .toolbar-group {
                padding: 8px 14px;
                gap: 7px;
            }

            .tool {
                height: 40px;
                min-width: 40px;
                font-size: 13.5px;
                padding: 0 14px;
            }

            .tool i {
                font-size: 15px;
            }

            .tool span {
                font-size: 13px;
            }

            .toolbar-divider {
                margin: 0 6px;
                height: 34px;
            }
        }

        /* 중간 크기 화면 (992px ~ 1200px) 최적화 */
        @media screen and (min-width: 992px) and (max-width: 1200px) {
            .toolbar {
                gap: 8px;
                padding: 16px 20px !important;
            }

            .toolbar::-webkit-scrollbar {
                height: 8px;
            }

            .toolbar-group {
                padding: 7px 11px;
            }

            .tool {
                height: 37px;
                min-width: 37px;
                font-size: 12.5px;
                padding: 0 11px;
            }

            .tool i {
                font-size: 13.5px;
            }

            .tool span {
                font-size: 12px;
            }

            .toolbarHeader::-webkit-scrollbar {
                height: 6px;
            }
        }

        .bottomSavebar {
            height: auto;
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 15px;
            margin-top: 40px;
            padding-top: 30px;
            border-top: 2px solid var(--border-color);
        }
        .bottomCancel, .bottomSave {
            height: 56px;
            width: 48%;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
            font-weight: 700;
            border-radius: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 16px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }
        .bottomCancel {
            background: var(--white);
            color: var(--text-primary);
            border: 2px solid var(--border-color);
        }
        .bottomCancel:hover {
            background: var(--bg-cream);
            border-color: var(--primary-light);
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.12);
        }
        .bottomSave {
            background: linear-gradient(135deg, var(--accent-green) 0%, #6B8E63 100%);
            color: var(--white);
            border: none;
            box-shadow: 0 4px 12px rgba(123, 163, 114, 0.3);
        }
        .bottomSave:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(123, 163, 114, 0.4);
        }

        /* 커스텀 모달 스타일 유지 */
        .custom-modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(93, 64, 55, 0.4); backdrop-filter: blur(4px); z-index: 9999; justify-content: center; align-items: center; animation: fadeIn 0.2s ease; }
        .custom-modal-overlay.active { display: flex; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { from { transform: translateY(30px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .custom-modal { background: var(--card-bg); border-radius: 20px; padding: 40px 35px; max-width: 420px; width: 90%; box-shadow: 0 10px 40px rgba(166, 124, 82, 0.3); animation: slideUp 0.3s ease; text-align: center; border: 1px solid var(--border-color); }
        .modal-icon { width: 70px; height: 70px; margin: 0 auto 20px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 36px; }
        .modal-icon.success { background: linear-gradient(135deg, #E8F5E9 0%, #C8E6C9 100%); color: var(--accent-green); }
        .modal-icon.error { background: linear-gradient(135deg, #FFE8EC 0%, #FFD6DC 100%); color: var(--accent-red); }
        .modal-icon.warning { background: linear-gradient(135deg, #FFF3E0 0%, #FFE0B2 100%); color: #F57C00; }
        .modal-icon.confirm { background: linear-gradient(135deg, var(--bg-cream) 0%, var(--border-color) 100%); color: var(--primary); }
        .modal-title { font-size: 22px; font-weight: 700; color: var(--text-primary); margin-bottom: 12px; }
        .modal-message { font-size: 15px; color: var(--text-secondary); line-height: 1.6; margin-bottom: 30px; }
        .modal-buttons { display: flex; gap: 10px; justify-content: center; }
        .modal-btn { padding: 12px 30px; border: none; border-radius: 12px; font-size: 15px; font-weight: 600; cursor: pointer; transition: all 0.2s ease; min-width: 100px; }
        .modal-btn.primary { background: linear-gradient(135deg, var(--accent-green) 0%, #6B8E63 100%); color: white; }
        .modal-btn.primary:hover { transform: translateY(-2px); }
        .modal-btn.secondary { background: var(--bg-cream); color: var(--text-primary); border: 2px solid var(--border-color); }
        .modal-btn.secondary:hover { background: var(--border-color); transform: translateY(-2px); }

        /* --- 태블릿 & 아이패드 반응형 --- */
        @media screen and (max-width: 991px) {
            body {
                padding: 90px 0 50px;
            }

            .form-wrapper {
                padding: 0 30px;
                max-width: 100%;
            }

            .contentForm {
                padding: 2.5rem !important;
                border-radius: 20px;
            }

            .form-title {
                font-size: 1.75rem;
                margin-bottom: 1.75rem;
                padding-bottom: 1.25rem;
            }

            .input-wrapper {
                gap: 10px;
                margin-bottom: 1.25rem;
            }

            .toolbar {
                padding: 16px 20px !important;
                gap: 8px;
                justify-content: flex-start;
            }

            .toolbar::-webkit-scrollbar {
                height: 7px;
            }

            .toolbar-group {
                padding: 7px 10px;
                gap: 5px;
            }

            .toolbar-divider {
                margin: 0 6px;
                height: 30px;
            }

            .tool {
                height: 36px;
                min-width: 36px;
                font-size: 12px;
                padding: 0 10px;
            }

            .tool i {
                font-size: 13px;
            }

            .tool span {
                font-size: 11px;
            }

            .toolbarHeader::-webkit-scrollbar {
                height: 5px;
            }

            .editor {
                min-height: 450px;
                padding: 18px;
                font-size: 15px;
            }

            .bottomSavebar {
                height: 55px;
                margin-top: 25px;
            }

            .bottomCancel, .bottomSave {
                height: 52px;
                font-size: 15px;
            }
        }

        /* --- 모바일 반응형 --- */
        @media screen and (max-width: 768px) {
            body {
                padding: 80px 0 40px;
            }

            .form-wrapper {
                padding: 0 16px;
                max-width: 100%;
            }

            .contentForm {
                padding: 1.75rem 1.25rem !important;
                border-radius: 16px;
            }

            .contentForm::before {
                height: 3px;
            }

            .form-title {
                font-size: 1.5rem;
                margin-bottom: 1.5rem;
                padding-bottom: 1rem;
                gap: 8px;
            }

            .form-title i {
                font-size: 1.4rem;
            }

            /* 입력 필드 세로 배치 */
            .input-wrapper {
                flex-direction: column;
                gap: 12px;
                margin-bottom: 1.25rem;
            }

            .input-group-custom.club-select {
                max-width: 100%;
            }

            .input-label {
                font-size: 0.85rem;
                margin-bottom: 6px;
            }

            #clubSelect, .title {
                width: 100%;
                height: 48px;
                font-size: 15px;
                margin-right: 0;
                padding: 0 16px;
            }

            #clubSelect {
                font-size: 14px;
                padding-right: 36px;
                background-size: 16px;
            }

            .title {
                font-size: 16px;
            }

            .toolbar {
                padding: 14px 16px !important;
                gap: 6px;
                border-radius: 12px;
                margin: 20px 0;
            }

            .toolbar-divider {
                margin: 0 3px;
                height: 28px;
            }

            .toolbar-group {
                gap: 4px;
                padding: 6px 8px;
            }

            .tool {
                height: 38px;
                min-width: 38px;
                width: 38px;
                padding: 0;
                font-size: 11px;
            }

            .tool i {
                font-size: 15px;
                margin: 0;
            }

            /* 툴바 텍스트 숨기고 아이콘만 표시 */
            .tool span {
                display: none;
            }

            /* select 툴은 최소 너비 유지 */
            select.tool {
                min-width: 70px;
                width: auto;
                padding: 0 24px 0 8px;
                font-size: 11px;
            }

            .editor {
                min-height: 300px;
                padding: 16px;
                font-size: 15px;
                line-height: 1.6;
            }

            .editor-label {
                font-size: 0.85rem;
                margin-bottom: 6px;
            }

            .bottomSavebar {
                margin-top: 30px;
                padding-top: 20px;
                gap: 10px;
            }

            .bottomCancel, .bottomSave {
                height: 50px;
                font-size: 15px;
            }

            .toolbarHeader {
                min-height: 60px;
                padding: 12px 15px !important;
                gap: 6px;
            }

            .toolbarHeader .toolbar-group {
                gap: 4px;
                padding: 6px 8px;
            }

            .toolbarHeader .tool {
                height: 36px;
                min-width: 36px;
                width: 36px;
                padding: 0;
            }

            .toolbarHeader .tool i {
                font-size: 14px;
            }

            .toolbarHeader .tool span {
                display: none;
            }

            .toolbarHeader select.tool {
                min-width: 65px;
                width: auto;
                padding: 0 22px 0 6px;
                font-size: 10px;
            }
        }

        /* --- 작은 모바일 --- */
        @media screen and (max-width: 480px) {
            .form-wrapper {
                padding: 0 12px;
            }

            .contentForm {
                padding: 1.5rem 1rem !important;
            }

            .toolbar {
                padding: 12px 14px !important;
                gap: 5px;
            }

            .toolbar-group {
                padding: 5px 7px;
                gap: 3px;
            }

            .tool {
                height: 36px;
                min-width: 36px;
                width: 36px;
                padding: 0;
            }

            .tool i {
                font-size: 14px;
            }

            .tool span {
                display: none;
            }

            select.tool {
                min-width: 65px;
                padding: 0 22px 0 6px;
                font-size: 10px;
            }

            .toolbarHeader {
                min-height: 55px;
                padding: 10px 12px !important;
            }

            .toolbarHeader .toolbar-group {
                padding: 5px 7px;
            }

            .toolbarHeader .tool {
                height: 34px;
                min-width: 34px;
                width: 34px;
            }

            .toolbarHeader .tool i {
                font-size: 13px;
            }

            .toolbarHeader .tool span {
                display: none;
            }

            .toolbarHeader select.tool {
                min-width: 60px;
                font-size: 9px;
            }
        }
    </style>
    <script th:inline="javascript">
        // 기존 JS 코드 유지 (생략 없이 사용 가능)
        let savedRange;
        let editor;

        function showModal(type, title, message, callback) {
            const overlay = document.getElementById('customModalOverlay');
            const icon = document.getElementById('modalIcon');
            const titleEl = document.getElementById('modalTitle');
            const messageEl = document.getElementById('modalMessage');
            const buttons = document.getElementById('modalButtons');
            icon.className = 'modal-icon ' + type;
            const icons = {'success': '✓', 'error': '✕', 'warning': '!', 'confirm': '?'};
            icon.textContent = icons[type] || '✓';
            titleEl.textContent = title;
            messageEl.textContent = message;

            if (type === 'confirm') {
                buttons.innerHTML = `<button class="modal-btn secondary" onclick="closeModal()">취소</button><button class="modal-btn primary" onclick="confirmAction()">확인</button>`;
                window.confirmCallback = callback;
            } else {
                buttons.innerHTML = `<button class="modal-btn primary" onclick="closeModal(${callback ? 'true' : ''})">확인</button>`;
                if (callback) window.modalCallback = callback;
            }
            overlay.classList.add('active');
        }

        function closeModal(executeCallback) {
            const overlay = document.getElementById('customModalOverlay');
            overlay.classList.remove('active');
            if (executeCallback && window.modalCallback) { window.modalCallback(); window.modalCallback = null; }
        }

        function confirmAction() { closeModal(); if (window.confirmCallback) { window.confirmCallback(); window.confirmCallback = null; } }

        function ajax(url, method, formElement, callback) {
            const formData = new FormData(formElement);
            formData.set('content', document.querySelector('.editor').innerHTML);
            fetch(url, { method: method.toUpperCase(), body: formData })
            .then(response => response.json()).then(data => { const cnt = parseInt(data); callback(isNaN(cnt) ? 0 : cnt); })
            .catch(error => { console.error('Fetch error:', error); callback(0); });
        }

        document.addEventListener('DOMContentLoaded', init);
        function init(){
            editor = document.querySelector('.editor');
            editor.focus();
            const range = document.createRange(); range.selectNodeContents(editor); range.collapse(false); savedRange = range.cloneRange();
            ['keyup', 'click', 'mouseup', 'focus', 'blur'].forEach(evt => editor.addEventListener(evt, updateSavedRange));
            editor.addEventListener('input', function () { if (this.innerHTML.trim() === "<br>" || this.innerHTML.trim() === "<div><br></div>") this.innerHTML = ''; });
            
            document.getElementById('fileInput').addEventListener('change', function(event) {
                const file = this.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const url = e.target.result; restoreSelection();
                        const img = document.createElement('img'); img.src = url;
                        savedRange.deleteContents(); savedRange.insertNode(img); savedRange.setStartAfter(img); savedRange.setEndAfter(img); savedRange.collapse(false);
                        const selection = window.getSelection(); selection.removeAllRanges(); selection.addRange(savedRange);
                        const br = document.createElement('br'); savedRange.insertNode(br); savedRange.setEndAfter(br); savedRange.collapse(false);
                        selection.removeAllRanges(); selection.addRange(savedRange);
                        document.getElementById('fileInput').value = ''; 
                    };
                    reader.readAsDataURL(file);
                }
            });

            document.querySelector("input[name='title']").addEventListener('keydown', function(event) { if (event.key === 'Enter') event.preventDefault(); });
            
            window.addEventListener("scroll", function () {
                let header = document.querySelector(".toolbarHeader");
                if (window.scrollY > 200) header.style.display = "flex"; else header.style.display = "none";
            });

            window.addEventListener("load", function () {
                const [navigation] = performance.getEntriesByType("navigation");
                if (navigation && navigation.type === "reload") {
                    document.querySelector("[name='title']").value = '';
                    document.querySelector(".editor").innerHTML = '';
                    window.sessionStorage.removeItem("title"); window.sessionStorage.removeItem("content");
                }
            });
        }

        function updateSavedRange() {
            const selection = window.getSelection();
            if (selection.rangeCount > 0) { const range = selection.getRangeAt(0); if (editor.contains(range.commonAncestorContainer)) savedRange = range.cloneRange(); }
        }

        function restoreSelection() {
            editor.focus();
            if (savedRange) { const selection = window.getSelection(); selection.removeAllRanges(); selection.addRange(savedRange); } 
            else { const range = document.createRange(); range.selectNodeContents(editor); range.collapse(false); savedRange = range; }
        }

        function inputHr(){
            restoreSelection(); const hr = document.createElement('hr'); hr.style.display = 'block'; hr.style.border = 'none'; hr.style.borderTop = '2px solid #F2C9D4';
            savedRange.deleteContents(); savedRange.insertNode(hr); savedRange.setStartAfter(hr); savedRange.setEndAfter(hr); savedRange.collapse(false);
            const selection = window.getSelection(); selection.removeAllRanges(); selection.addRange(savedRange);
        }

        function execCommand(command, value = '') { document.execCommand(command, false, value); editor.focus(); updateSavedRange(); }
        function preventFocusLoss(e) { if (e.target.tagName === 'SELECT' || e.target.tagName === 'OPTION') return; e.preventDefault(); }

        function alignText(alignType) {
            restoreSelection(); document.execCommand(alignType, false, null);
            const selection = window.getSelection();
            if (selection.rangeCount > 0) {
                const range = selection.getRangeAt(0); let container = range.commonAncestorContainer;
                if (container.nodeType === 3) container = container.parentNode;
                const allImages = editor.querySelectorAll('img');
                allImages.forEach(img => {
                    if (selection.containsNode(img, true)) {
                        img.style.marginLeft = ''; img.style.marginRight = '';
                        if (alignType === 'justifyCenter') { img.style.marginLeft = 'auto'; img.style.marginRight = 'auto'; }
                        else if (alignType === 'justifyRight') { img.style.marginLeft = 'auto'; img.style.marginRight = '0'; }
                        else if (alignType === 'justifyLeft') { img.style.marginLeft = '0'; img.style.marginRight = 'auto'; }
                    }
                });
            }
            editor.focus(); updateSavedRange();
        }

        function fontStyle(font) { execCommand('fontName', font); }
        function setFontSize(size) { execCommand('fontSize', size); }
        function setFontColor(color) { execCommand('foreColor', color); }
        function setBackgroundColor(color) { execCommand('backColor', color); }
        
        function uploadPost(){
            const editorEl = document.querySelector(".editor");
            const clubSelect = document.getElementById('clubSelect');
            const titleInput = document.querySelector("[name='title']");
            const content = editorEl.innerHTML;
            const title = titleInput.value.trim();

            if(clubSelect && clubSelect.value === '0'){ showModal('warning', '동아리 선택 필요', '동아리를 선택해주세요.', () => clubSelect.scrollIntoView({ behavior: 'smooth' })); return; }
            if(title===""){ showModal('warning', '제목 입력 필요', '제목을 입력해주세요.', () => titleInput.scrollIntoView({ behavior: 'smooth' })); return; }
            else if(title.length > 25){ showModal('warning', '제목 길이 초과', '제목은 25글자 이하로 써주세요.', () => titleInput.scrollIntoView({ behavior: 'smooth' })); return; }
            if(content.trim()===""){ showModal('warning', '내용 입력 필요', '내용을 입력해주세요.', () => editorEl.scrollIntoView({ behavior: 'smooth' })); return; }

            const editorSize = new Blob([content]).size;
            if (editorSize > 1024 * 1024 * 10) { showModal('error', '용량 초과', '게시글 용량이 너무 큽니다.\n(이미지 포함 10MB 제한)'); return; }

            document.querySelector("[name='content']").value = content;
            const idInput = document.querySelector("input[name='id']");
            const id = idInput ? idInput.value : '';
            const url = (id && id !== "0") ? "/freeboard/edit/" + id : "/freeboard/write";
            var formObj = document.forms['contentForm'];
            
            ajax(url, "post", formObj, function (cnt) {
                if(Number(cnt) > 0){
                    if(id && id !== "0") { showModal('success', '수정 완료', '게시글이 성공적으로 수정되었습니다.', () => location.href = "/freeboard/" + id); }
                    else { showModal('success', '작성 완료', '게시글이 성공적으로 작성되었습니다.', () => location.replace("/freeboard/list")); }
                } else { showModal('error', '실패', '게시글 저장에 실패했습니다.'); }
            });
        }
        function cancel(){ showModal('confirm', '작성 취소', '작성을 취소하시겠습니까?', () => location.href='/freeboard/list'); }
    </script>
</head>
<body>
<div class="form-wrapper">
<form class="contentForm bg-white p-3" name="contentForm">
    <input type="hidden" name="id" th:value="${post != null ? post.id : 0}">

    <div class="form-title">
        <i class="bi bi-pencil-square"></i>
        <span th:text="${post == null} ? '새 게시글 작성' : '게시글 수정'">새 게시글 작성</span>
    </div>

    <div class="input-wrapper">
        <div class="input-group-custom club-select" th:if="${post == null}">
            <label class="input-label">
                <i class="bi bi-people-fill"></i>
                동아리
            </label>
            <select id="clubSelect" name="clubId" required>
                <option value="0">동아리를 선택하세요</option>
                <option th:each="club : ${myClubList}"
                        th:value="${club.id}"
                        th:text="${club.clubName}"> </option>
            </select>
        </div>
        <input th:if="${post != null}" type="hidden" name="clubId" th:value="${post.clubId}">

        <div class="input-group-custom">
            <label class="input-label">
                <i class="bi bi-card-heading"></i>
                제목
            </label>
            <input type="text" name="title" class="title" placeholder="제목을 입력하세요 (최대 25자)" th:value="${post != null ? post.title : ''}">
        </div>
    </div>
    
    <div class="toolbar p-3" onmousedown="preventFocusLoss(event)">
        <!-- 이미지 & 구분선 -->
        <div class="toolbar-group">
            <button type="button" class="tool" title="이미지 삽입" onclick="document.getElementById('fileInput').click()"><i class="fa-regular fa-image"></i><span>이미지</span></button>
            <input type="file" id="fileInput" name="image" style="display:none;" accept="image/*">
            <button type="button" class="tool" title="수평선" onclick="inputHr()"><i class="fa-solid fa-minus"></i><span>구분선</span></button>
        </div>

        <div class="toolbar-divider"></div>

        <!-- 글꼴 & 크기 & 색상 -->
        <div class="toolbar-group">
            <select class="tool" onchange="fontStyle(this.value)" title="글꼴">
                <option value="sans-serif">기본</option>
                <option value="Malgun Gothic">맑은고딕</option>
                <option value="Nanum Gothic">나눔고딕</option>
                <option value="NanumSquare">나눔스퀘어</option>
                <option value="Gulim">굴림</option>
                <option value="Dotum">돋움</option>
                <option value="Batang">바탕</option>
                <option value="Gungsuh">궁서</option>
            </select>
            <select class="tool" onchange="setFontSize(this.value)" title="크기">
                <option value="1">10</option>
                <option value="2">13</option>
                <option value="3">16</option>
                <option value="4" selected>18</option>
                <option value="5">24</option>
                <option value="6">32</option>
                <option value="7">48</option>
            </select>
        </div>

        <div class="toolbar-divider"></div>

        <!-- 색상 -->
        <div class="toolbar-group">
            <input type="color" id="colorPicker" style="display:none;" onchange="setFontColor(this.value)">
            <button type="button" class="tool" title="글자 색상" onclick="document.getElementById('colorPicker').click()">
                <i class="fa-solid fa-palette"></i><span>색상</span>
            </button>
        </div>

        <div class="toolbar-divider"></div>

        <!-- 텍스트 스타일 -->
        <div class="toolbar-group">
            <button type="button" class="tool" onclick="execCommand('bold')" title="굵게"><i class="fa-solid fa-bold"></i><span>굵게</span></button>
            <button type="button" class="tool" onclick="execCommand('italic')" title="기울임"><i class="fa-solid fa-italic"></i><span>기울임</span></button>
            <button type="button" class="tool" onclick="execCommand('underline')" title="밑줄"><i class="fa-solid fa-underline"></i><span>밑줄</span></button>
            <button type="button" class="tool" onclick="execCommand('strikeThrough')" title="취소선"><i class="fa-solid fa-strikethrough"></i><span>취소선</span></button>
        </div>

        <div class="toolbar-divider"></div>

        <!-- 정렬 -->
        <div class="toolbar-group">
            <button type="button" class="tool" onclick="alignText('justifyLeft')" title="왼쪽 정렬"><i class="fa-solid fa-align-left"></i><span>왼쪽</span></button>
            <button type="button" class="tool" onclick="alignText('justifyCenter')" title="가운데 정렬"><i class="fa-solid fa-align-center"></i><span>가운데</span></button>
            <button type="button" class="tool" onclick="alignText('justifyRight')" title="오른쪽 정렬"><i class="fa-solid fa-align-right"></i><span>오른쪽</span></button>
        </div>
    </div>

    <div class="editor-wrapper">
        <label class="editor-label">
            <i class="bi bi-file-text"></i>
            내용
        </label>
        <div class="editor" contenteditable="true" spellcheck="false" th:utext="${post != null ? post.content : ''}" placeholder="내용을 입력해주세요."></div>
    </div>

    <div class="bottomSavebar">
        <span class="bottomCancel" onclick="cancel()">
            <i class="bi bi-x-circle"></i>
            취소
        </span>
        <span class="bottomSave" onclick="uploadPost()">
            <i class="bi bi-check-circle-fill"></i>
            <span th:text="${post == null} ? '저장' : '수정완료'">저장</span>
        </span>
    </div>

    <input type="hidden" name="content">
</form>

<div class="toolbarHeader p-3" onmousedown="preventFocusLoss(event)">
   <div class="toolbar-group">
        <button type="button" class="tool" title="이미지 삽입" onclick="document.getElementById('fileInput').click()"><i class="fa-regular fa-image"></i><span>이미지</span></button>
        <button type="button" class="tool" title="수평선" onclick="inputHr()"><i class="fa-solid fa-minus"></i><span>구분선</span></button>
    </div>
    <div class="toolbar-divider"></div>
    <div class="toolbar-group">
        <select class="tool" onchange="fontStyle(this.value)" title="글꼴">
            <option value="sans-serif">기본</option>
            <option value="Malgun Gothic">맑은고딕</option>
            <option value="Nanum Gothic">나눔고딕</option>
            <option value="NanumSquare">나눔스퀘어</option>
        </select>
        <select class="tool" onchange="setFontSize(this.value)" title="크기">
            <option value="3">16</option>
            <option value="4" selected>18</option>
            <option value="5">24</option>
            <option value="6">32</option>
        </select>
    </div>
    <div class="toolbar-divider"></div>
    <div class="toolbar-group">
        <input type="color" id="colorPickerHeader" style="display:none;" onchange="setFontColor(this.value)">
        <button type="button" class="tool" title="글자 색상" onclick="document.getElementById('colorPickerHeader').click()">
            <i class="fa-solid fa-palette"></i><span>색상</span>
        </button>
    </div>
    <div class="toolbar-divider"></div>
    <div class="toolbar-group">
        <button type="button" class="tool" onclick="execCommand('bold')" title="굵게"><i class="fa-solid fa-bold"></i><span>굵게</span></button>
        <button type="button" class="tool" onclick="execCommand('italic')" title="기울임"><i class="fa-solid fa-italic"></i><span>기울임</span></button>
        <button type="button" class="tool" onclick="execCommand('underline')" title="밑줄"><i class="fa-solid fa-underline"></i><span>밑줄</span></button>
    </div>
    <div class="toolbar-divider"></div>
    <div class="toolbar-group">
        <button type="button" class="tool" onclick="alignText('justifyLeft')" title="왼쪽 정렬"><i class="fa-solid fa-align-left"></i><span>왼쪽</span></button>
        <button type="button" class="tool" onclick="alignText('justifyCenter')" title="가운데 정렬"><i class="fa-solid fa-align-center"></i><span>가운데</span></button>
        <button type="button" class="tool" onclick="alignText('justifyRight')" title="오른쪽 정렬"><i class="fa-solid fa-align-right"></i><span>오른쪽</span></button>
    </div>
</div>

<div id="customModalOverlay" class="custom-modal-overlay" onclick="if(event.target === this) closeModal()">
    <div class="custom-modal">
        <div id="modalIcon" class="modal-icon success">✓</div>
        <div id="modalTitle" class="modal-title">알림</div>
        <div id="modalMessage" class="modal-message">메시지</div>
        <div id="modalButtons" class="modal-buttons">
            <button class="modal-btn primary" onclick="closeModal()">확인</button>
        </div>
    </div>
</div>
</div>
</body>
</html>