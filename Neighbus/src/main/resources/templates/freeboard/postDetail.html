<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title th:text="|${post.title} - 자유게시판 - 동네친구|">자유게시판 게시글 상세 - 동네친구</title>

	<link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@400;500;600;700;800&display=swap" rel="stylesheet">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="/css/navibar.css">
	<style>
		:root {
					--primary-color: #F97316;
					--accent-color: #F97316;
					--background-color: #F8FAFC;
					--text-primary: #1E293B;
					--text-secondary: #64748B;
					--border-color: #E2E8F0;
					--card-bg: #FFFFFF;
				}

				body {
					font-family: 'Pretendard', sans-serif;
					background: var(--background-color);
					color: var(--text-primary);
					margin: 0;
				}

		    

				.container {
					max-width: 900px;
					margin: 40px auto;
					padding: 0 20px;
				}

				.post-container {
					background: var(--card-bg);
					border-radius: 24px;
					padding: 40px;
					box-shadow: 0 10px 30px rgba(0, 0, 0, 0.07);
				}

				.post-header .post-title {
					font-size: 32px;
					font-weight: 800;
					margin-bottom: 15px;
					color: var(--text-primary);
				}

				.post-meta {
					display: flex;
					align-items: center;
					gap: 20px;
					color: var(--text-secondary);
					font-size: 14px;
					margin-bottom: 30px;
					padding-bottom: 30px;
					border-bottom: 1px solid var(--border-color);
				}

				.post-meta span {
					display: flex;
					align-items: center;
					gap: 8px;
				}

				.post-content {
					font-size: 16px;
					line-height: 1.8;
					margin-bottom: 40px;
					color: var(--text-primary);
					white-space: pre-wrap;
					/* 줄바꿈 유지를 위해 추가 */
				}

				/* ▼ 게시글 하단 버튼 (목록/수정/삭제) ▼ */
				.post-actions-footer {
					display: flex;
					justify-content: space-between;
					margin-top: 30px;
					padding-top: 20px;
					border-top: 1px solid var(--border-color);
				}

				.post-actions-footer .btn-list {
					background: #F1F5F9;
					color: var(--text-primary);
				}

				.post-actions-footer .btn-edit {
					background: var(--accent-color);
					color: white;
				}

				.post-actions-footer .btn-delete {
					background: #ef4444;
					color: white;
				}

				.post-actions-footer a {
					padding: 12px 25px;
					border-radius: 10px;
					font-weight: 600;
					text-decoration: none;
					font-size: 15px;
					transition: all 0.3s;
				}

				.post-actions-footer a:hover {
					transform: translateY(-2px);
					box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
				}
				
				/* ▼ 댓글 섹션 ▼ */
				.comment-section {
					margin-top: 40px;
				}

				.comment-header {
					font-size: 20px;
					font-weight: 700;
					margin-bottom: 20px;
					color: var(--text-primary);
				}

				#comment-list {
					list-style: none;
					padding: 0;
				}

				.comment-item {
					display: flex;
					gap: 15px;
					padding: 20px 0;
					border-top: 1px solid var(--border-color);
				}

				.comment-item:first-child {
					border-top: 1px solid var(--border-color);
				}

				.comment-avatar {
					width: 40px;
					height: 40px;
					border-radius: 50%;
					background-color: var(--border-color);
					/* 임시 아바타 */
				}

				.comment-body {
					flex: 1;
				}

				.comment-info {
					display: flex;
					align-items: center;
					gap: 10px;
					margin-bottom: 8px;
				}

				.comment-author {
					font-weight: 600;
					color: var(--text-primary);
				}

				.comment-time {
					font-size: 12px;
					color: var(--text-secondary);
				}

				.comment-content {
					margin-bottom: 10px;
					color: var(--text-primary);
					white-space: pre-wrap;
					/* 댓글 줄바꿈 유지 */
				}

				.comment-actions {
					display: flex;
					gap: 15px;
					font-size: 13px;
				}

				.comment-actions button,
				.comment-actions a {
					background: none;
					border: none;
					color: var(--text-secondary);
					cursor: pointer;
					padding: 0;
					text-decoration: none;
				}

				.comment-actions a.comment-delete-btn {
					color: #ef4444;
				}

				.comment-actions a i,
				.comment-actions button i {
					margin-right: 4px;
				}

				/* ▼ 댓글 작성 폼 ▼ */
				#comment-form {
					display: flex;
					gap: 10px;
					margin-top: 20px;
					margin-bottom: 30px;
					align-items: flex-start;
				}

				#comment-form textarea {
					flex-grow: 1;
					border: 1px solid var(--border-color);
					border-radius: 10px;
					padding: 12px;
					resize: vertical;
					min-height: 40px;
					font-family: 'Pretendard', sans-serif;
				}

				#comment-form button {
					padding: 12px 20px;
					border: none;
					background: var(--accent-color);
					color: white;
					border-radius: 10px;
					cursor: pointer;
					font-weight: 600;
				}
	</style>
	
	
</head>
			
<body>
	<!--네비바-->
	<div th:replace="include/navibar :: header-nav"></div>
	
	<div class="container">
		<div class="post-container">
			<div class="post-header">
				<h1 class="post-title" th:text="${post.title}">게시글 제목이 여기에 표시됩니다.</h1>
				<div class="post-meta">
					<span><i class="fa-regular fa-user"></i> <span th:text="${post.writerNickname}">작성자</span></span>
					<span><i class="fa-regular fa-clock"></i> <span
							th:text="${#temporals.format(post.createdAt, 'yyyy.MM.dd HH:mm')}">2025.01.01</span></span>
					<span><i class="fa-regular fa-eye"></i> <span th:text="${post.viewCount}">0</span></span>
				</div>
			</div>

			<div class="post-content" th:text="${post.content}">
				게시글 내용이 여기에 로드됩니다.
				줄바꿈도 처리됩니다.
			</div>

			<div class="post-actions-footer">
				<a th:href="@{/freeboard}" class="btn-list">목록으로</a>

				<div class="post-actions" style="display: flex; gap: 12px;">
					<a th:href="@{|/freeboard/edit/${post.id}|}" class="btn-edit"
						th:if="${currentUserId != 0 and currentUserId == post.writer}">수정</a>
					<a th:href="@{|/freeboard/delete/${post.id}|}" class="btn-delete"
						th:if="${currentUserId != 0 and currentUserId == post.writer}"
						onclick="return confirm('정말로 삭제하시겠습니까?');">삭제</a>
				</div>
			</div>

			<div class="comment-section">
				<h2 class="comment-header">댓글 <span th:text="${#lists.size(comments)}">0</span>개</h2>

				<form id="comment-form">
					<input type="hidden" id="freeboardId" name="freeboard" th:value="${post.id}">
					<textarea id="commentContent" name="content" placeholder="댓글을 입력하세요..." required></textarea>
					<button type="submit" id="submitCommentBtn">등록</button>
				</form>

				<ul id="comment-list">
					<li class="comment-item" th:each="comment : ${comments}" th:id="|comment-${comment.id}|"
						th:attr="data-writer-id=${comment.writer}">
						<div class="comment-avatar">
						</div>
						<div class="comment-body">
							<div class="comment-info">
								<span class="comment-author" th:text="${comment.writerUsername}">익명</span>
								<span class="comment-time"
									th:text="${#temporals.format(comment.createdAt, 'yyyy.MM.dd HH:mm')}">2025.11.04</span>
							</div>
							<div class="comment-content" th:text="${comment.content}">댓글 내용입니다.</div>
							<div class="comment-actions">
								<a href="#" class="comment-delete-btn"
									th:if="${currentUserId != 0 and currentUserId == comment.writer}"
									th:attr="data-comment-id=${comment.id}"
									onclick="deleteComment(this.getAttribute('data-comment-id')); return false;">
									<i class="fa-regular fa-trash-can"></i> 삭제
								</a>
							</div>
						</div>
					</li>
				</ul>
			</div>
		</div>
	</div>


	<script>
		document.addEventListener('DOMContentLoaded', function() {
			document.getElementById('comment-form').addEventListener('submit', function (event) {
				event.preventDefault();

				const freeboardId = document.getElementById('freeboardId').value;
				const content = document.getElementById('commentContent').value;

				const commentData = {
					freeboard: freeboardId,
					content: content
				};

				fetch('/freeboard/comment', {
					method: 'POST',
					headers: {
						'Content-Type': 'application/json'
					},
					body: JSON.stringify(commentData)
				})
					.then(response => {
						return response.text().then(text => {
							return {
								status: response.status,
								ok: response.ok,
								text: text
							};
						});
					})
					.then(response => {
						if (response.ok) {
							alert('댓글이 성공적으로 등록되었습니다. (상태 코드: ' + response.status + ')\n페이지를 새로고침합니다.');
							location.reload();
						} else {
							alert('댓글 등록에 실패했습니다. (상태 코드: ' + response.status + ')\n서버 응답: ' + response.text);
						}
					})
					.catch(error => {
						console.error('Error:', error);
						alert('스크립트 오류가 발생했습니다: ' + error.message);
					});
			});
		});

		function deleteComment(commentId) {
			if (!confirm('정말로 삭제하시겠습니까?')) {
				return;
			}

			fetch(`/freeboard/comment/${commentId}`, {
				method: 'DELETE'
			})
				.then(response => {
					return response.text().then(text => {
						return {
							status: response.status,
							ok: response.ok,
							text: text
						};
					});
				})
				.then(response => {
					if (response.ok) {
						alert('댓글이 삭제되었습니다. (상태 코드: ' + response.status + ')');
						const commentElement = document.getElementById(`comment-${commentId}`);
						if (commentElement) {
							commentElement.remove();
						}
					} else {
						alert('댓글 삭제에 실패했습니다. (상태 코드: ' + response.status + ')\n서버 응답: ' + response.text);
					}
				})
				.catch(error => {
					console.error('Error:', error);
					alert('스크립트 오류가 발생했습니다: ' + error.message);
				});
		}
	</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>