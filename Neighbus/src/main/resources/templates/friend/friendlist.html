<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEIGHBUS - 친구 목록</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link href="https://cdn.jsdelivr.net/gh/sunn-us/SUIT/fonts/static/woff2/SUIT.css" rel="stylesheet">
    <link rel="stylesheet" href="/css/navibar.css">

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --primary: #A67C52;
            --primary-dark: #8D6E63;
            --primary-light: #C9A88A;
            --accent-red: #C87E7E;
            --bg-ivory: #FFF8F0;
            --bg-warm: #FFF5EB;
            --card-bg: #FFFBF7;
            --text-primary: #5D4037;
            --text-secondary: #8D6E63;
            --border-color: #E8D7C3;
            --shadow-color: rgba(166, 124, 82, 0.1);
            --white: #FFFFFF;
        }
        body {
            font-family: 'SUIT', sans-serif;
            color: var(--text-primary);
            background: linear-gradient(165deg, var(--bg-ivory) 0%, var(--bg-warm) 50%, #FAF0E6 100%);
            overflow-x: hidden;
            min-height: 100vh;
            padding-top: 100px; /* 네비바 높이만큼 패딩 추가 */
        }

        /* --- 친구 목록 & 채팅 페이지 전용 스타일 --- */

        .main-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
            height: calc(100vh - 120px); /* 네비게이션 높이 + padding 제외 */
            display: flex;
            gap: 1.5rem;
            position: relative;
            overflow: hidden;
        }

        /* 1. 친구 목록 영역 */
        .friend-section {
            flex: 1; /* 기본적으로 꽉 채움 */
            background: var(--white);
            border-radius: 20px;
            box-shadow: 0 10px 30px var(--shadow-color);
            border: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            height: 100%;
            z-index: 10;
        }

        /* 채팅방이 열렸을 때 친구 목록 스타일 (폭이 줄어듦) */
        .friend-section.shrink {
            flex: 0 0 400px; /* 고정 너비 혹은 %로 설정 가능 */
        }

        .section-header {
            padding: 1.5rem 2rem;
            border-bottom: 1px solid var(--border-color);
            background: var(--bg-warm);
            border-radius: 20px 20px 0 0;
        }

        .section-title-text {
            font-size: 1.2rem;
            font-weight: 800;
            color: var(--text-primary);
        }

        .friend-list-wrapper {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
        }

        /* 스크롤바 커스텀 */
        .friend-list-wrapper::-webkit-scrollbar { width: 6px; }
        .friend-list-wrapper::-webkit-scrollbar-thumb { background: var(--primary-light); border-radius: 10px; }

        .friend-card {
            display: flex;
            align-items: center;
            background: var(--card-bg);
            padding: 1rem;
            border-radius: 12px;
            margin-bottom: 1rem;
            border: 1px solid transparent;
            transition: all 0.3s ease;
        }

        .friend-card:hover {
            border-color: var(--primary-light);
            box-shadow: 0 4px 12px var(--shadow-color);
            transform: translateY(-2px);
        }

        .friend-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--bg-ivory);
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .friend-info {
            flex: 1;
            margin-left: 1rem;
        }

        .friend-name {
            font-weight: 700;
            font-size: 1rem;
            color: var(--text-primary);
        }

        .friend-status {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-top: 2px;
        }

        .friend-actions {
            display: flex;
            gap: 0.5rem;
        }

        .btn-action {
            padding: 0.4rem 0.8rem;
            border-radius: 8px;
            font-size: 0.85rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid transparent;
        }

        .btn-chat {
            background-color: var(--bg-ivory);
            color: var(--primary);
            border-color: var(--primary);
        }

        .btn-chat:hover {
            background-color: var(--primary);
            color: var(--white);
        }

        .btn-delete {
            background-color: transparent;
            color: var(--accent-red);
        }

        .btn-delete:hover {
            background-color: #FFF0F0;
        }

        /* 2. 채팅창 영역 */
        .chat-section {
            position: absolute; /* 슬라이딩 효과를 위해 absolute 혹은 flex로 제어 */
            right: 2rem; /* main-container padding 고려 */
            top: 2rem;
            bottom: 2rem;
            width: calc(100% - 400px - 3.5rem); /* 전체 - 친구목록너비 - 간격 */
            background: var(--white);
            border-radius: 20px;
            box-shadow: 0 10px 30px var(--shadow-color);
            border: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            
            /* 애니메이션 초기 상태: 숨김 */
            transform: translateX(110%); 
            opacity: 0;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 5;
        }

        /* 채팅방 열림 상태 */
        .chat-section.active {
            transform: translateX(0);
            opacity: 1;
        }

        .chat-header {
            padding: 1rem 1.5rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--bg-warm);
            border-radius: 20px 20px 0 0;
        }

        .chat-user-info {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 700;
        }

        .btn-close-chat {
            background: none;
            border: none;
            font-size: 1.2rem;
            color: var(--text-secondary);
            cursor: pointer;
        }

        .chat-body {
            flex: 1;
            padding: 1.5rem;
            overflow-y: auto;
            background-color: var(--bg-ivory);
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .chat-bubble {
            max-width: 70%;
            padding: 0.8rem 1.2rem;
            border-radius: 15px;
            font-size: 0.95rem;
            line-height: 1.5;
            position: relative;
        }

        .chat-bubble.receive {
            background: var(--white);
            color: var(--text-primary);
            align-self: flex-start;
            border-bottom-left-radius: 2px;
            border: 1px solid var(--border-color);
        }

        .chat-bubble.sent {
            background: var(--primary);
            color: var(--white);
            align-self: flex-end;
            border-bottom-right-radius: 2px;
        }

        .chat-footer {
            padding: 1rem;
            background: var(--white);
            border-top: 1px solid var(--border-color);
            border-radius: 0 0 20px 20px;
        }

        .chat-input-group {
            display: flex;
            gap: 10px;
            background: var(--bg-warm);
            padding: 0.5rem;
            border-radius: 50px;
            border: 1px solid var(--border-color);
        }

        .chat-input {
            flex: 1;
            border: none;
            background: transparent;
            padding: 0.5rem 1rem;
            outline: none;
            font-size: 0.95rem;
        }

        .btn-send {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary);
            color: var(--white);
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background 0.2s;
        }
        .btn-send:hover { background: var(--primary-dark); }

        /* 반응형 처리 */
        @media (max-width: 992px) {
            .friend-section.shrink { flex: 0 0 320px; }
            .chat-section { width: calc(100% - 320px - 3.5rem); }
        }

        @media (max-width: 768px) {
            body {
                padding-top: 80px; /* 모바일에서는 네비바 높이가 작을 수 있음 */
            }

            .main-container {
                padding: 1rem;
                height: calc(100vh - 100px);
            }

            /* 모바일에서는 친구목록이 완전히 사라지거나 오버레이 */
            .friend-section.shrink {
                display: none;
            }
            .chat-section {
                width: 100%;
                right: 0;
                top: 0;
                bottom: 0;
                height: 100%;
                border-radius: 0;
                transform: translateX(100%);
            }
            .chat-section.active {
                position: fixed;
                z-index: 1000;
                transform: translateX(0);
            }
            .chat-header { border-radius: 0; }
            .chat-footer { border-radius: 0; }
        }
    </style>
</head>
<body>

    <div th:replace="include/navibar :: header-nav"></div>

    <div class="main-container">
        <div class="friend-section" id="friendSection">
            <div class="section-header">
                <span class="section-title-text"><i class="bi bi-person-heart me-2"></i>내 친구 목록</span>
                <span class="badge rounded-pill bg-secondary ms-2" th:text="${#lists.size(friendList)}">0</span>
            </div>

            <div class="friend-list-wrapper">
                <div th:if="${#lists.isEmpty(friendList)}" class="text-center py-5">
                    <p class="text-muted">아직 등록된 친구가 없습니다.</p>
                </div>

                <div class="friend-card" th:each="friend : ${friendList}">
                    <img th:src="@{|/img/profile/${friend.image}|}" class="friend-avatar" alt="프로필">
                    <div class="friend-info">
                        <div class="friend-name" th:text="${friend.name}"></div>
                        <div class="friend-status">오늘 날씨가 참 좋네요! ☀️</div>
                    </div>
                    <div class="friend-actions">
                        <button class="btn-action btn-chat" onclick="openChat('${friend.name}', '${friend.id}')">
                            <i class="bi bi-chat-dots-fill me-1"></i>채팅
                        </button>
                        <button class="btn-action btn-delete" onclick="confirmDelete('${friend.id}')">
                            <i class="bi bi-person-x-fill"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div class="chat-section" id="chatSection">
            <div class="chat-header">
                <div class="chat-user-info">
                    <img src="" id="chatAvatar" class="friend-avatar" style="width: 35px; height: 35px;" alt="">
                    <span id="chatUserName">사용자 이름</span>
                </div>
                <button class="btn-close-chat" onclick="closeChat()">
                    <i class="bi bi-x-lg"></i>
                </button>
            </div>
            
            <div class="chat-body" id="chatBody">
                <div class="text-center mb-3">
                    <span class="badge bg-light text-secondary rounded-pill px-3 py-2">2025년 11월 27일</span>
                </div>
                <div class="chat-bubble receive">안녕하세요! 잘 지내시나요?</div>
                <div class="chat-bubble sent">네! 요즘 NEIGHBUS에서 모임 활동하느라 바쁘네요 ㅎㅎ</div>
                <div class="chat-bubble receive">오 저도 관심 있는데, 어떤 모임 하시나요?</div>
            </div>

            <div class="chat-footer">
                <div class="chat-input-group">
                    <input type="text" class="chat-input" id="messageInput" placeholder="메시지를 입력하세요..." onkeypress="handleEnter(event)">
                    <button class="btn-send" onclick="sendMessage()">
                        <i class="bi bi-send-fill"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const friendSection = document.getElementById('friendSection');
        const chatSection = document.getElementById('chatSection');
        const chatUserName = document.getElementById('chatUserName');
        const chatAvatar = document.getElementById('chatAvatar');
        const chatBody = document.getElementById('chatBody');

        // 채팅방 열기
        function openChat(name, friendId) {
        	console.log(name);
        	console.log(friendId);
            // 1. 친구 목록 영역 줄이기 (shrink 클래스 추가)
            friendSection.classList.add('shrink');
            
            // 2. 채팅방 영역 보이기 (active 클래스 추가)
            chatSection.classList.add('active');

            // 3. 채팅방 정보 업데이트 (이름, 이미지 등)
            // 실제 구현 시에는 friendId를 통해 서버에서 데이터를 가져오거나 DOM에서 추출
            chatUserName.innerText = name;
            
            // 클릭한 친구의 이미지 가져오기 (예시 로직)
            // 실제로는 Thymeleaf 변수나 dataset을 활용하세요.
            // 여기서는 단순히 클릭된 요소 근처의 이미지를 찾거나 하드코딩된 예시를 보여줍니다.
            // DOM 탐색 예시:
            // const clickedCard = document.getElementById(friendId);
            // const imgSrc = clickedCard.querySelector('.friend-avatar').src;
            // chatAvatar.src = imgSrc;
            
            // 임시 이미지 설정
            chatAvatar.src = "https://images.unsplash.com/photo-1535713875002-d1d0cf377fde?q=80&w=100"; 
            
            // 모바일 환경 대응 (스크롤 막기 등)
            if(window.innerWidth <= 768) {
                document.body.style.overflow = 'hidden';
            }
        }

        // 채팅방 닫기
        function closeChat() {
            friendSection.classList.remove('shrink');
            chatSection.classList.remove('active');
            
            if(window.innerWidth <= 768) {
                document.body.style.overflow = 'auto';
            }
        }

        // 친구 삭제 확인
        function confirmDelete() {
            if(confirm("정말로 이 친구를 목록에서 삭제하시겠습니까?")) {
                alert("삭제되었습니다.");
                // 실제 삭제 로직 (AJAX 등)
            }
        }

        // 메시지 전송 (UI 시뮬레이션)
        function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            
            if(message) {
                // 내 메시지 추가
                const bubble = document.createElement('div');
                bubble.className = 'chat-bubble sent fade-in'; // fade-in 애니메이션 있다면 적용
                bubble.innerText = message;
                chatBody.appendChild(bubble);
                
                input.value = '';
                chatBody.scrollTop = chatBody.scrollHeight; // 스크롤 하단으로

                // (심심하니까) 1초 뒤 자동 응답 시뮬레이션
                setTimeout(() => {
                    const reply = document.createElement('div');
                    reply.className = 'chat-bubble receive';
                    reply.innerText = "답장입니다: " + message;
                    chatBody.appendChild(reply);
                    chatBody.scrollTop = chatBody.scrollHeight;
                }, 1000);
            }
        }

        function handleEnter(e) {
            if(e.key === 'Enter') {
                sendMessage();
            }
        }
    </script>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>