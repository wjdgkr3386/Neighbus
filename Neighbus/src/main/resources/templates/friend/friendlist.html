<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEIGHBUS - ì¹œêµ¬ ëª©ë¡</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link href="https://cdn.jsdelivr.net/gh/sunn-us/SUIT/fonts/static/woff2/SUIT.css" rel="stylesheet">
    <link rel="stylesheet" href="/css/navibar.css">

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --primary: #A67C52;
            --primary-dark: #8D6E63;
            --primary-light: #C9A88A;
            --accent-red: #C87E7E;
            --bg-ivory: #FFF8F0;
            --bg-warm: #FFF5EB;
            --card-bg: #FFFBF7;
            --text-primary: #5D4037;
            --text-secondary: #8D6E63;
            --border-color: #E8D7C3;
            --shadow-color: rgba(166, 124, 82, 0.1);
            --white: #FFFFFF;
        }
        body {
            font-family: 'SUIT', sans-serif;
            color: var(--text-primary);
            background: linear-gradient(165deg, var(--bg-ivory) 0%, var(--bg-warm) 50%, #FAF0E6 100%);
            overflow-x: hidden;
            min-height: 100vh;
            padding-top: 100px; /* ë„¤ë¹„ë°” ë†’ì´ë§Œí¼ íŒ¨ë”© ì¶”ê°€ */
        }

        /* --- ì¹œêµ¬ ëª©ë¡ & ì±„íŒ… í˜ì´ì§€ ì „ìš© ìŠ¤íƒ€ì¼ --- */

        .main-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
            height: calc(100vh - 120px); /* ë„¤ë¹„ê²Œì´ì…˜ ë†’ì´ + padding ì œì™¸ */
            display: flex;
            gap: 1.5rem;
            position: relative;
            overflow: hidden;
        }

        /* 1. ì¹œêµ¬ ëª©ë¡ ì˜ì—­ */
        .friend-section {
            flex: 1; /* ê¸°ë³¸ì ìœ¼ë¡œ ê½‰ ì±„ì›€ */
            background: var(--white);
            border-radius: 20px;
            box-shadow: 0 10px 30px var(--shadow-color);
            border: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            height: 100%;
            z-index: 10;
        }

        /* ì±„íŒ…ë°©ì´ ì—´ë ¸ì„ ë•Œ ì¹œêµ¬ ëª©ë¡ ìŠ¤íƒ€ì¼ (í­ì´ ì¤„ì–´ë“¦) */
        .friend-section.shrink {
            flex: 0 0 400px; /* ê³ ì • ë„ˆë¹„ í˜¹ì€ %ë¡œ ì„¤ì • ê°€ëŠ¥ */
        }

        .section-header {
            padding: 1.5rem 2rem;
            border-bottom: 1px solid var(--border-color);
            background: var(--bg-warm);
            border-radius: 20px 20px 0 0;
        }

        .section-title-text {
            font-size: 1.2rem;
            font-weight: 800;
            color: var(--text-primary);
        }

        .friend-list-wrapper {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
        }

        /* ìŠ¤í¬ë¡¤ë°” ì»¤ìŠ¤í…€ */
        .friend-list-wrapper::-webkit-scrollbar { width: 6px; }
        .friend-list-wrapper::-webkit-scrollbar-thumb { background: var(--primary-light); border-radius: 10px; }

        .friend-card {
            display: flex;
            align-items: center;
            background: var(--card-bg);
            padding: 1rem;
            border-radius: 12px;
            margin-bottom: 1rem;
            border: 1px solid transparent;
            transition: all 0.3s ease;
        }

        .friend-card:hover {
            border-color: var(--primary-light);
            box-shadow: 0 4px 12px var(--shadow-color);
            transform: translateY(-2px);
        }

        .friend-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--bg-ivory);
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .friend-info {
            flex: 1;
            margin-left: 1rem;
        }

        .friend-name {
            font-weight: 700;
            font-size: 1rem;
            color: var(--text-primary);
        }

        .friend-status {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-top: 2px;
        }

        .friend-actions {
            display: flex;
            gap: 0.5rem;
        }

        .btn-action {
            padding: 0.4rem 0.8rem;
            border-radius: 8px;
            font-size: 0.85rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid transparent;
        }

        .btn-chat {
            background-color: var(--bg-ivory);
            color: var(--primary);
            border-color: var(--primary);
        }

        .btn-chat:hover {
            background-color: var(--primary);
            color: var(--white);
        }

        .btn-delete {
            background-color: transparent;
            color: var(--accent-red);
        }

        .btn-delete:hover {
            background-color: #FFF0F0;
        }

        /* 2. ì±„íŒ…ì°½ ì˜ì—­ */
        .chat-section {
            position: absolute; /* ìŠ¬ë¼ì´ë”© íš¨ê³¼ë¥¼ ìœ„í•´ absolute í˜¹ì€ flexë¡œ ì œì–´ */
            right: 2rem; /* main-container padding ê³ ë ¤ */
            top: 2rem;
            bottom: 2rem;
            width: calc(100% - 400px - 3.5rem); /* ì „ì²´ - ì¹œêµ¬ëª©ë¡ë„ˆë¹„ - ê°„ê²© */
            background: var(--white);
            border-radius: 20px;
            box-shadow: 0 10px 30px var(--shadow-color);
            border: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            
            /* ì• ë‹ˆë©”ì´ì…˜ ì´ˆê¸° ìƒíƒœ: ìˆ¨ê¹€ */
            transform: translateX(110%); 
            opacity: 0;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 5;
        }

        /* ì±„íŒ…ë°© ì—´ë¦¼ ìƒíƒœ */
        .chat-section.active {
            transform: translateX(0);
            opacity: 1;
        }

        .chat-header {
            padding: 1rem 1.5rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--bg-warm);
            border-radius: 20px 20px 0 0;
        }

        .chat-user-info {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 700;
        }

        .btn-close-chat {
            background: none;
            border: none;
            font-size: 1.2rem;
            color: var(--text-secondary);
            cursor: pointer;
        }

        .chat-body {
            flex: 1;
            padding: 1.5rem;
            overflow-y: auto;
            background-color: var(--bg-ivory);
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .chat-bubble {
            max-width: 70%;
            padding: 0.8rem 1.2rem;
            border-radius: 15px;
            font-size: 0.95rem;
            line-height: 1.5;
            position: relative;
        }

        .chat-bubble.receive {
            background: var(--white);
            color: var(--text-primary);
            align-self: flex-start;
            border-bottom-left-radius: 2px;
            border: 1px solid var(--border-color);
        }

        .chat-bubble.sent {
            background: var(--primary);
            color: var(--white);
            align-self: flex-end;
            border-bottom-right-radius: 2px;
        }

        .chat-footer {
            padding: 1rem;
            background: var(--white);
            border-top: 1px solid var(--border-color);
            border-radius: 0 0 20px 20px;
        }

        .chat-input-group {
            display: flex;
            gap: 10px;
            background: var(--bg-warm);
            padding: 0.5rem;
            border-radius: 50px;
            border: 1px solid var(--border-color);
        }

        .chat-input {
            flex: 1;
            border: none;
            background: transparent;
            padding: 0.5rem 1rem;
            outline: none;
            font-size: 0.95rem;
        }

        .btn-send {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary);
            color: var(--white);
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background 0.2s;
        }
        .btn-send:hover { background: var(--primary-dark); }

        /* ë°˜ì‘í˜• ì²˜ë¦¬ */
        @media (max-width: 992px) {
            .friend-section.shrink { flex: 0 0 320px; }
            .chat-section { width: calc(100% - 320px - 3.5rem); }
        }

        @media (max-width: 768px) {
            body {
                padding-top: 80px; /* ëª¨ë°”ì¼ì—ì„œëŠ” ë„¤ë¹„ë°” ë†’ì´ê°€ ì‘ì„ ìˆ˜ ìˆìŒ */
            }

            .main-container {
                padding: 1rem;
                height: calc(100vh - 100px);
            }

            /* ëª¨ë°”ì¼ì—ì„œëŠ” ì¹œêµ¬ëª©ë¡ì´ ì™„ì „íˆ ì‚¬ë¼ì§€ê±°ë‚˜ ì˜¤ë²„ë ˆì´ */
            .friend-section.shrink {
                display: none;
            }
            .chat-section {
                width: 100%;
                right: 0;
                top: 0;
                bottom: 0;
                height: 100%;
                border-radius: 0;
                transform: translateX(100%);
            }
            .chat-section.active {
                position: fixed;
                z-index: 1000;
                transform: translateX(0);
            }
            .chat-header { border-radius: 0; }
            .chat-footer { border-radius: 0; }
        }
    </style>
</head>
<body>

    <div th:replace="include/navibar :: header-nav"></div>

    <div class="main-container">
        <div class="friend-section" id="friendSection">
            <div class="section-header">
                <span class="section-title-text"><i class="bi bi-person-heart me-2"></i>ë‚´ ì¹œêµ¬ ëª©ë¡</span>
                <span class="badge rounded-pill bg-secondary ms-2" th:text="${#lists.size(friendList)}">0</span>
            </div>

            <div class="friend-list-wrapper">
                <div th:if="${#lists.isEmpty(friendList)}" class="text-center py-5">
                    <p class="text-muted">ì•„ì§ ë“±ë¡ëœ ì¹œêµ¬ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                </div>

                <div class="friend-card" id="friend-1">
                    <img src="https://images.unsplash.com/photo-1535713875002-d1d0cf377fde?q=80&w=100" class="friend-avatar" alt="í”„ë¡œí•„">
                    <div class="friend-info">
                        <div class="friend-name">ê¹€ì´ì›ƒ</div>
                        <div class="friend-status">ì˜¤ëŠ˜ ë‚ ì”¨ê°€ ì°¸ ì¢‹ë„¤ìš”! â˜€ï¸</div>
                    </div>
                    <div class="friend-actions">
                        <button class="btn-action btn-chat" onclick="openChat('ê¹€ì´ì›ƒ', 'friend-1')">
                            <i class="bi bi-chat-dots-fill me-1"></i>ì±„íŒ…
                        </button>
                        <button class="btn-action btn-delete" onclick="confirmDelete()">
                            <i class="bi bi-person-x-fill"></i>
                        </button>
                    </div>
                </div>

                <div class="friend-card" id="friend-2">
                    <img src="https://images.unsplash.com/photo-1494790108377-be9c29b29330?q=80&w=100" class="friend-avatar" alt="í”„ë¡œí•„">
                    <div class="friend-info">
                        <div class="friend-name">ë°•ì„œë¡œ</div>
                        <div class="friend-status">ì½”ë”© ê³µë¶€ ì¤‘... ğŸ’»</div>
                    </div>
                    <div class="friend-actions">
                        <button class="btn-action btn-chat" onclick="openChat('ë°•ì„œë¡œ', 'friend-2')">
                            <i class="bi bi-chat-dots-fill me-1"></i>ì±„íŒ…
                        </button>
                        <button class="btn-action btn-delete">
                            <i class="bi bi-person-x-fill"></i>
                        </button>
                    </div>
                </div>
                
                <div class="friend-card">
                    <img src="https://images.unsplash.com/photo-1599566150163-29194dcaad36?q=80&w=100" class="friend-avatar" alt="í”„ë¡œí•„">
                    <div class="friend-info">
                        <div class="friend-name">ìµœì„±ì¥</div>
                        <div class="friend-status">ì‚¬ì´ë“œ í”„ë¡œì íŠ¸ ëª¨ì§‘í•´ìš”</div>
                    </div>
                    <div class="friend-actions">
                        <button class="btn-action btn-chat" onclick="openChat('ìµœì„±ì¥', 'friend-3')">
                            <i class="bi bi-chat-dots-fill me-1"></i>ì±„íŒ…
                        </button>
                        <button class="btn-action btn-delete">
                            <i class="bi bi-person-x-fill"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div class="chat-section" id="chatSection">
            <div class="chat-header">
                <div class="chat-user-info">
                    <img src="" id="chatAvatar" class="friend-avatar" style="width: 35px; height: 35px;" alt="">
                    <span id="chatUserName">ì‚¬ìš©ì ì´ë¦„</span>
                </div>
                <button class="btn-close-chat" onclick="closeChat()">
                    <i class="bi bi-x-lg"></i>
                </button>
            </div>
            
            <div class="chat-body" id="chatBody">
                <div class="text-center mb-3">
                    <span class="badge bg-light text-secondary rounded-pill px-3 py-2">2025ë…„ 11ì›” 27ì¼</span>
                </div>
                <div class="chat-bubble receive">ì•ˆë…•í•˜ì„¸ìš”! ì˜ ì§€ë‚´ì‹œë‚˜ìš”?</div>
                <div class="chat-bubble sent">ë„¤! ìš”ì¦˜ NEIGHBUSì—ì„œ ëª¨ì„ í™œë™í•˜ëŠë¼ ë°”ì˜ë„¤ìš” ã…ã…</div>
                <div class="chat-bubble receive">ì˜¤ ì €ë„ ê´€ì‹¬ ìˆëŠ”ë°, ì–´ë–¤ ëª¨ì„ í•˜ì‹œë‚˜ìš”?</div>
            </div>

            <div class="chat-footer">
                <div class="chat-input-group">
                    <input type="text" class="chat-input" id="messageInput" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”..." onkeypress="handleEnter(event)">
                    <button class="btn-send" onclick="sendMessage()">
                        <i class="bi bi-send-fill"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const friendSection = document.getElementById('friendSection');
        const chatSection = document.getElementById('chatSection');
        const chatUserName = document.getElementById('chatUserName');
        const chatAvatar = document.getElementById('chatAvatar');
        const chatBody = document.getElementById('chatBody');

        // ì±„íŒ…ë°© ì—´ê¸°
        function openChat(name, friendId) {
            // 1. ì¹œêµ¬ ëª©ë¡ ì˜ì—­ ì¤„ì´ê¸° (shrink í´ë˜ìŠ¤ ì¶”ê°€)
            friendSection.classList.add('shrink');
            
            // 2. ì±„íŒ…ë°© ì˜ì—­ ë³´ì´ê¸° (active í´ë˜ìŠ¤ ì¶”ê°€)
            chatSection.classList.add('active');

            // 3. ì±„íŒ…ë°© ì •ë³´ ì—…ë°ì´íŠ¸ (ì´ë¦„, ì´ë¯¸ì§€ ë“±)
            // ì‹¤ì œ êµ¬í˜„ ì‹œì—ëŠ” friendIdë¥¼ í†µí•´ ì„œë²„ì—ì„œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ê±°ë‚˜ DOMì—ì„œ ì¶”ì¶œ
            chatUserName.innerText = name;
            
            // í´ë¦­í•œ ì¹œêµ¬ì˜ ì´ë¯¸ì§€ ê°€ì ¸ì˜¤ê¸° (ì˜ˆì‹œ ë¡œì§)
            // ì‹¤ì œë¡œëŠ” Thymeleaf ë³€ìˆ˜ë‚˜ datasetì„ í™œìš©í•˜ì„¸ìš”.
            // ì—¬ê¸°ì„œëŠ” ë‹¨ìˆœíˆ í´ë¦­ëœ ìš”ì†Œ ê·¼ì²˜ì˜ ì´ë¯¸ì§€ë¥¼ ì°¾ê±°ë‚˜ í•˜ë“œì½”ë”©ëœ ì˜ˆì‹œë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤.
            // DOM íƒìƒ‰ ì˜ˆì‹œ:
            // const clickedCard = document.getElementById(friendId);
            // const imgSrc = clickedCard.querySelector('.friend-avatar').src;
            // chatAvatar.src = imgSrc;
            
            // ì„ì‹œ ì´ë¯¸ì§€ ì„¤ì •
            chatAvatar.src = "https://images.unsplash.com/photo-1535713875002-d1d0cf377fde?q=80&w=100"; 
            
            // ëª¨ë°”ì¼ í™˜ê²½ ëŒ€ì‘ (ìŠ¤í¬ë¡¤ ë§‰ê¸° ë“±)
            if(window.innerWidth <= 768) {
                document.body.style.overflow = 'hidden';
            }
        }

        // ì±„íŒ…ë°© ë‹«ê¸°
        function closeChat() {
            friendSection.classList.remove('shrink');
            chatSection.classList.remove('active');
            
            if(window.innerWidth <= 768) {
                document.body.style.overflow = 'auto';
            }
        }

        // ì¹œêµ¬ ì‚­ì œ í™•ì¸
        function confirmDelete() {
            if(confirm("ì •ë§ë¡œ ì´ ì¹œêµ¬ë¥¼ ëª©ë¡ì—ì„œ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
                alert("ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
                // ì‹¤ì œ ì‚­ì œ ë¡œì§ (AJAX ë“±)
            }
        }

        // ë©”ì‹œì§€ ì „ì†¡ (UI ì‹œë®¬ë ˆì´ì…˜)
        function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            
            if(message) {
                // ë‚´ ë©”ì‹œì§€ ì¶”ê°€
                const bubble = document.createElement('div');
                bubble.className = 'chat-bubble sent fade-in'; // fade-in ì• ë‹ˆë©”ì´ì…˜ ìˆë‹¤ë©´ ì ìš©
                bubble.innerText = message;
                chatBody.appendChild(bubble);
                
                input.value = '';
                chatBody.scrollTop = chatBody.scrollHeight; // ìŠ¤í¬ë¡¤ í•˜ë‹¨ìœ¼ë¡œ

                // (ì‹¬ì‹¬í•˜ë‹ˆê¹Œ) 1ì´ˆ ë’¤ ìë™ ì‘ë‹µ ì‹œë®¬ë ˆì´ì…˜
                setTimeout(() => {
                    const reply = document.createElement('div');
                    reply.className = 'chat-bubble receive';
                    reply.innerText = "ë‹µì¥ì…ë‹ˆë‹¤: " + message;
                    chatBody.appendChild(reply);
                    chatBody.scrollTop = chatBody.scrollHeight;
                }, 1000);
            }
        }

        function handleEnter(e) {
            if(e.key === 'Enter') {
                sendMessage();
            }
        }
    </script>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>