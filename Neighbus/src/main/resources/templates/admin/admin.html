<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
      th:replace="~{admin/layout :: ~{html}(pageTitle='대시보드', activeMenu='dashboard')}">

<head>
    <!-- This head section is a placeholder and will be replaced by the layout. -->
    <title>대시보드</title>
</head>

<body>
    <!-- This fragment will replace the content block in layout.html -->
    <main class="main-content" th:fragment="content">
        <div class="page-header">
            <h1>대시보드</h1>
            <p>사이트의 주요 현황을 한눈에 확인하세요.</p>
        </div>

        <!-- Stat Cards -->
        <div class="stat-cards-grid">
            <div class="stat-card">
                <div class="icon"><i class="fa-solid fa-users"></i></div>
                <div class="info">
                    <p class="title">총 회원 수</p>
                    <p class="value" id="total-users">-</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="icon"><i class="fa-solid fa-user-plus"></i></div>
                <div class="info">
                    <p class="title">오늘 가입자</p>
                    <p class="value" id="today-signups">-</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="icon"><i class="fa-solid fa-file-lines"></i></div>
                <div class="info">
                    <p class="title">총 게시글</p>
                    <p class="value" id="total-posts">-</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="icon"><i class="fa-solid fa-circle-question"></i></div>
                <div class="info">
                    <p class="title">처리 대기 문의</p>
                    <p class="value" id="pending-inquiries">-</p>
                </div>
            </div>
        </div>

        <!-- Charts -->
        <div class="dashboard-grid" style="margin-top: 2rem;">
            <div class="content-panel">
                <h3>월별 가입자 수</h3>
                <canvas id="monthlySignupsChart"></canvas>
            </div>
            <div class="content-panel">
                <h3>카테고리별 모임 수</h3>
                <canvas id="categoryChart"></canvas>
            </div>
        </div>

        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <script>
            document.addEventListener('DOMContentLoaded', function() {
                // Chart.js 전역 설정
                Chart.defaults.font.family = "'Pretendard', sans-serif";
                Chart.defaults.color = 'var(--text-secondary)';

                // API 호출 함수들
                async function fetchAndDisplayStats() {
                    try {
                        // 이 API 엔드포인트들은 실제 프로젝트에 맞게 구현되어야 합니다.
                        // 지금은 더미 데이터를 사용합니다.
                        const stats = { totalUsers: 1256, todaySignups: 12, totalPosts: 874, pendingInquiries: 3 };
                        
                        document.getElementById('total-users').textContent = (stats.totalUsers || 0).toLocaleString();
                        document.getElementById('today-signups').textContent = (stats.todaySignups || 0).toLocaleString();
                        document.getElementById('total-posts').textContent = (stats.totalPosts || 0).toLocaleString();
                        document.getElementById('pending-inquiries').textContent = (stats.pendingInquiries || 0).toLocaleString();

                    } catch (error) {
                        console.error('Error loading dashboard stats:', error);
                    }
                }

                function renderMonthlySignupsChart() {
                    // 더미 데이터
                    const labels = ['1월', '2월', '3월', '4월', '5월', '6월'];
                    const data = [65, 59, 80, 81, 56, 55];
                    
                    const ctx = document.getElementById('monthlySignupsChart');
                    if (ctx) {
                        new Chart(ctx.getContext('2d'), {
                            type: 'bar',
                            data: {
                                labels: labels,
                                datasets: [{
                                    label: '월별 가입자 수',
                                    data: data,
                                    backgroundColor: 'rgba(166, 124, 82, 0.5)',
                                    borderColor: 'rgba(166, 124, 82, 1)',
                                    borderWidth: 1,
                                }]
                            },
                            options: {
                                responsive: true,
                                scales: { y: { beginAtZero: true } },
                                plugins: { legend: { display: false } }
                            }
                        });
                    }
                }

                function renderCategoryChart() {
                    const ctx = document.getElementById('categoryChart');
                    if (ctx) {
                        new Chart(ctx.getContext('2d'), {
                            type: 'doughnut',
                            data: {
                                labels: ['러닝/조깅', '등산', '스터디', '독서', '요리'],
                                datasets: [{
                                    label: '카테고리별 모임 수',
                                    data: [12, 19, 8, 5, 4],
                                    backgroundColor: ['#A67C52', '#C9A88A', '#8D6E63', '#E8D7C3', '#5D4037'],
                                    hoverOffset: 4
                                }]
                            },
                            options: {
                                responsive: true,
                                plugins: { legend: { position: 'top' } }
                            }
                        });
                    }
                }

                // 함수 실행
                fetchAndDisplayStats();
                renderMonthlySignupsChart();
                renderCategoryChart();
            });
        </script>
    </main>
</body>
</html>