<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
      th:replace="~{admin/layout :: layout(pageTitle='신고 관리', activeMenu='reports', content=~{:: #reports-content})}">
<body>
    <div id="reports-content">
        <div class="page-header">
            <h1>신고 관리</h1>
            <p>사용자가 제출한 신고 내역을 확인하고 처리합니다.</p>
        </div>

        <!-- Stats -->
        <div class="stat-cards-grid">
            <div class="stat-card">
                <div class="icon"><i class="fa-solid fa-flag"></i></div>
                <div class="info"><p class="title">총 신고</p><p class="value" id="total-reports">0</p></div>
            </div>
            <div class="stat-card">
                <div class="icon"><i class="fa-solid fa-clock"></i></div>
                <div class="info"><p class="title">대기 중</p><p class="value" id="pending-reports">0</p></div>
            </div>
            <div class="stat-card">
                <div class="icon"><i class="fa-solid fa-spinner"></i></div>
                <div class="info"><p class="title">처리 중</p><p class="value" id="processing-reports">0</p></div>
            </div>
            <div class="stat-card">
                <div class="icon"><i class="fa-solid fa-check-circle"></i></div>
                <div class="info"><p class="title">처리 완료</p><p class="value" id="completed-reports">0</p></div>
            </div>
        </div>

        <!-- Table and Filters -->
        <div class="content-panel" style="margin-top: 2rem;">
            <div class="search-controls">
                <input type="text" id="search-input" placeholder="신고자 또는 대상으로 검색...">
                <select id="status-filter">
                    <option value="">전체 상태</option>
                    <option value="대기중">대기중</option>
                    <option value="처리중">처리중</option>
                    <option value="완료">완료</option>
                    <option value="기각">기각</option>
                </select>
                <select id="type-filter">
                    <option value="">전체 유형</option>
                    <option value="게시글">게시글</option>
                    <option value="댓글">댓글</option>
                    <option value="사용자">사용자</option>
                </select>
            </div>
            <div class="table-wrapper" style="overflow-x: auto;">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>유형</th>
                            <th>신고자</th>
                            <th>신고 대상</th>
                            <th>신고 사유</th>
                            <th>신고일</th>
                            <th>상태</th>
                            <th class="actions">관리</th>
                        </tr>
                    </thead>
                    <tbody id="report-table-body">
                        <!-- JS로 채워짐 -->
                    </tbody>
                </table>
            </div>
        </div>

        <script>
            let reports = [];
            let filteredReports = [];

            document.addEventListener('DOMContentLoaded', function() {
                const style = document.createElement('style');
                style.innerHTML = `
                    .status-badge { padding: 4px 10px; border-radius: 12px; font-weight: 600; font-size: 0.8rem; }
                    .status-badge.pending { background: #FEF3C7; color: #92400E; }
                    .status-badge.processing { background: #DBEAFE; color: #1E40AF; }
                    .status-badge.completed { background: var(--accent-green-light); color: var(--accent-green); }
                    .status-badge.dismissed { background: #F3F4F6; color: #6B7280; }
                    .type-badge { display: inline-block; padding: 4px 8px; border-radius: 8px; font-size: 12px; font-weight: 500; background: #F3F4F6; color: #374151; }
                `;
                document.head.appendChild(style);

                reports = [
                    { id: 1, type: '게시글', reporter: '김신고', target: '홍길동의 게시글', reason: '스팸/광고', date: '2025-11-12', status: '대기중' },
                    { id: 2, type: '댓글', reporter: '이제보', target: '박댓글의 댓글', reason: '욕설/비방', date: '2025-11-11', status: '처리중' },
                    { id: 3, type: '사용자', reporter: '최관리', target: '정유저', reason: '부적절한 프로필', date: '2025-11-10', status: '완료' },
                    { id: 4, type: '모임', reporter: '박모임', target: '등산 모임', reason: '허위 정보', date: '2025-11-09', status: '기각' },
                    { id: 5, type: '게시글', reporter: '윤신고', target: '강게시의 게시글', reason: '음란물/선정성', date: '2025-11-12', status: '대기중' },
                ];
                filteredReports = [...reports];

                updateStats();
                renderTable();

                document.getElementById('search-input').addEventListener('input', applyFilters);
                document.getElementById('status-filter').addEventListener('change', applyFilters);
                document.getElementById('type-filter').addEventListener('change', applyFilters);
            });

            function updateStats() {
                document.getElementById('total-reports').textContent = reports.length;
                document.getElementById('pending-reports').textContent = reports.filter(r => r.status === '대기중').length;
                document.getElementById('processing-reports').textContent = reports.filter(r => r.status === '처리중').length;
                document.getElementById('completed-reports').textContent = reports.filter(r => r.status === '완료').length;
            }

            function renderTable(reportsToRender = filteredReports) {
                const tableBody = document.getElementById('report-table-body');
                tableBody.innerHTML = '';
                reportsToRender.forEach(report => {
                    const originalIndex = reports.indexOf(report);
                    let statusClass = 'pending';
                    if (report.status === '처리중') statusClass = 'processing';
                    else if (report.status === '완료') statusClass = 'completed';
                    else if (report.status === '기각') statusClass = 'dismissed';

                    const row = `
                        <tr>
                            <td>${report.id}</td>
                            <td><span class="type-badge">${report.type}</span></td>
                            <td>${report.reporter}</td>
                            <td>${report.target}</td>
                            <td>${report.reason}</td>
                            <td>${report.date}</td>
                            <td><span class="status-badge ${statusClass}">${report.status}</span></td>
                            <td class="actions">
                                <button class="btn btn-secondary" onclick="alert('신고 상세보기: ${report.target}')"><i class="fa-solid fa-eye"></i></button>
                                ${report.status === '대기중' ? `<button class="btn btn-primary" onclick="processReport(${originalIndex})">처리</button>` : ''}
                                ${report.status === '처리중' ? `<button class="btn btn-primary" style="background-color: var(--accent-green); border-color: var(--accent-green);" onclick="completeReport(${originalIndex})">완료</button>` : ''}
                            </td>
                        </tr>
                    `;
                    tableBody.innerHTML += row;
                });
            }

            function applyFilters() {
                const searchTerm = document.getElementById('search-input').value.toLowerCase();
                const statusFilter = document.getElementById('status-filter').value;
                const typeFilter = document.getElementById('type-filter').value;

                filteredReports = reports.filter(r => {
                    const matchesSearch = r.reporter.toLowerCase().includes(searchTerm) || r.target.toLowerCase().includes(searchTerm);
                    const matchesStatus = !statusFilter || r.status === statusFilter;
                    const matchesType = !typeFilter || r.type === typeFilter;
                    return matchesSearch && matchesStatus && matchesType;
                });

                renderTable();
            }

            function processReport(index) {
                if (confirm('이 신고를 처리 중으로 변경하시겠습니까?')) {
                    reports[index].status = '처리중';
                    applyFilters();
                    updateStats();
                }
            }

            function completeReport(index) {
                if (confirm('이 신고를 완료 처리하시겠습니까?')) {
                    reports[index].status = '완료';
                    applyFilters();
                    updateStats();
                }
            }
        </script>
    </div>
</body>
</html>
