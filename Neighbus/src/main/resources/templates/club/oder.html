<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Gatherings Page</title>
	<script src="/js/common.js"></script>
	<style>
	    /* 공통 변수 */
	    :root {
	        --primary-color: #F97316;
	        --primary-color-light: #FB923C;
	        --accent-color: #F97316;
	        --accent-color-hover: #EA580C;
	        --background-color: #FFFFFF; /* 바디 흰색 고정 */
	        --text-primary: #1E293B;
	        --text-secondary: #64748B;
	        --border-color: #E2E8F0;
	        --card-bg: #FFFFFF;
	    }

	    /* 컨테이너 */
	    .container {
	        max-width: 1200px;
	        margin: 0 auto;
	        padding: 40px 20px;
	    }

	    /* 셀렉트 + 버튼 그룹 */
		.region-select-group {
		    display: flex;
		    align-items: center;
		    gap: 12px;
		    flex-wrap: wrap; /* 화면이 좁으면 아래로 내려가게 */
		    margin-bottom: 30px;
		    background: #F9FAFB;
		    padding: 16px 20px;
		    border-radius: 12px;
		    border: 1px solid #E5E7EB;
		    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
		}

	    /* 셀렉트박스 스타일 */
	    select {
	        padding: 10px 14px;
	        border-radius: 8px;
	        border: 1px solid #D1D5DB;
	        background-color: #FFFFFF;
	        font-size: 14px;
	        color: var(--text-primary);
	        min-width: 140px;
	        transition: all 0.2s;
	    }

	    select:focus {
	        outline: none;
	        border-color: var(--primary-color);
	        box-shadow: 0 0 0 2px rgba(249, 115, 22, 0.2);
	    }

	    /* 버튼 스타일 */
		#filterBtn {
		    padding: 10px 20px;
		    border-radius: 8px;
		    border: none;
		    background-color: var(--accent-color);
		    color: white;
		    font-weight: 600;
		    cursor: pointer;
		    transition: all 0.2s;
		}

	    #filterBtn:hover {
	        background-color: var(--accent-color-hover);
	        transform: translateY(-2px);
	    }

	    /* 카드 그리드 */
	    .gatherings-grid {
	        display: grid;
	        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
	        gap: 25px;
	        margin-top: 20px;
	    }

	    /* 카드 스타일 */
	    .activity-card {
	        background: var(--card-bg);
	        border: 1px solid var(--border-color);
	        border-radius: 16px;
	        overflow: hidden;
	        box-shadow: 0 4px 16px rgba(0,0,0,0.05);
	        transition: all 0.3s;
	        text-decoration: none;
	        color: var(--text-primary);
	    }

	    .activity-card:hover {
	        transform: translateY(-5px);
	        box-shadow: 0 12px 24px rgba(0,0,0,0.1);
	    }

	    .card-image {
	        width: 100%;
	        height: 180px;
	        object-fit: cover;
	        background-color: var(--border-color);
	    }

	    .card-content {
	        padding: 20px;
	    }

	    .card-category {
	        display: inline-block;
	        padding: 5px 12px;
	        background: #EEF2FF;
	        color: var(--primary-color);
	        border-radius: 6px;
	        font-size: 12px;
	        font-weight: 700;
	        margin-bottom: 10px;
	    }

	    .card-title {
	        font-size: 18px;
	        font-weight: 700;
	        margin-bottom: 10px;
	        line-height: 1.4;
	    }

	    .card-footer {
	        display: flex;
	        justify-content: space-between;
	        align-items: center;
	        margin-top: 15px;
	        padding-top: 15px;
	        border-top: 1px solid #F1F5F9;
	        font-size: 13px;
	        color: #94A3B8;
	    }

	    .card-status.recruiting {
	        background: #DCFCE7;
	        color: #16A34A;
	        padding: 5px 12px;
	        border-radius: 6px;
	        font-weight: 700;
	        font-size: 12px;
	    }
	</style>


	
</head>

<body>
	<div th:replace="~{include/navibar :: header-nav}"></div>
	<div class="form-group full-width">
		<form id="goForm" name="goForm">
			<label for="province">시/도</label>
			<div class="region-select-group">
				<select id="province" name="provinceId" required>
					<option value="" disabled selected>시/도 선택</option>
					<option th:each="province : ${provinceList}" th:value="${province.get('id')}"
						th:text="${province.get('province')}"></option>
				</select>

				<select id="city" name="city" required disabled>
					<option value="" disabled selected>시/군/구 선택</option>
				</select>
			</div>
		</form>
		<button type="button" id="filterBtn">필터 적용</button>

		<div class="gatherings-grid" id="clubListFragment" th:fragment="clubListFragment">
			<a th:each="club : ${clubs}" th:href="@{/club/{id}(id=${club.id})}" class="activity-card">
				<img src="https://images.unsplash.com/photo-1511632765486-a01980e01a18?w=400" th:alt="${club.clubName}"
					class="card-image">
				<div class="card-content">
					<span class="card-category" th:text="${club.cityName}">지역명</span>
					<h3 class="card-title" th:text="${club.clubName}">동아리 이름</h3>
					<div class="card-footer">
						<span class="card-members">지역: <span th:text="${club.provinceName}">지역명</span></span>
						<span class="card-status recruiting">모집중</span>
					</div>
				</div>
			</a>
		</div>
		<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
		<script th:inline="javascript">
		    // Thymeleaf에서 regionList 데이터 주입
		    const regionList = /*[[${regionList}]]*/ null;

		    // 1. DOM이 완전히 로드된 후 스크립트 실행 (jQuery 방식)
		    $(document).ready(function() {

		        // 2. jQuery로 DOM 요소 선택
		        const $provinceSelect = $('#province');
		        const $citySelect = $('#city');
		        const $filterBtn = $('#filterBtn');
		        const $form = $("[name='goForm']");

		        // 3. province 변경 시 city 옵션 채우기
		        $provinceSelect.on('change', function () {
		            const selectedValue = parseInt(this.value, 10);
		            
		            // jQuery로 citySelect 초기화 및 비활성화
		            $citySelect.empty()
		                       .append('<option value="" disabled selected>시/군/구 선택</option>')
		                       .prop('disabled', true);

		            if (regionList && selectedValue) {
		                // regionList를 순회하며 일치하는 city 추가
		                $.each(regionList, function(i, region) {
		                    if (parseInt(region.province, 10) === selectedValue) {
		                        // jQuery로 옵션 생성 및 추가
		                        $citySelect.append($('<option>', {
		                            value: region.id,
		                            text: region.city
		                        }));
		                    }
		                });
		                
		                // citySelect 활성화
		                $citySelect.prop('disabled', false);
		            }
		        });

		        // 4. 필터 버튼 클릭 시 AJAX (HTML의 onclick="go()"를 이 코드로 대체)
		        $filterBtn.on('click', function() {
		            
		            // URL은 '/'로 시작하여 루트 경로 기준으로 설정하는 것이 안전합니다.
		            const ajaxUrl = "/club/filter-clubs";
		            const formData = $form.serialize(); // 폼 데이터 직렬화

		            $.ajax({
		                url: ajaxUrl,
		                type: "post",
		                data: formData,
		                success: function (response) {
		                    // 성공: 받아온 HTML 조각으로 화면 교체
		                    $("#clubListFragment").html(response);
		                },
		                error: function (xhr, status, error) {
		                    console.error("AJAX Error:", status, error);
		                    alert("필터링 중 오류가 발생했습니다.");
		                }
		            });
		        });
		    });
		</script>

</body>

</html>