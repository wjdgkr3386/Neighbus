<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.neighbus.mypage.MyPageMapper">

<!-- 내 정보 (AccountDTO 매핑) -->
  <select id="getMyInfo" parameterType="string" resultType="com.neighbus.account.AccountDTO">
    SELECT 
        u.id AS id,
        u.username AS username,
        u.password AS password,
        u.city AS city,
        u.address AS address,
        u.phone AS phone,
        u.email AS email,
        u.image AS image,
        u.grade AS grade,
        u.birth AS birth,
        u.sex AS sex,
        u.user_uuid AS userUuid,
        u.nickname AS nickname,       
      
        r.city AS city,  
        
        p.province AS province
    FROM users u
    
    LEFT JOIN cities r ON u.id = r.id
   
    LEFT JOIN provinces p ON r.id = p.id
    WHERE u.username = #{username}
  </select>

  <!-- 내가 쓴 글 목록 -->
  <select id="getMyPosts" parameterType="string" resultType="com.neighbus.freeboard.FreeboardDTO">
    SELECT 
        g.id AS postId,
        g.title AS title,
       	g.created_at AS createdAt,
        'gallery' AS boardType
    FROM galleries g  
    JOIN users u ON g.writer = u.id
    WHERE u.username = #{username}
    
    UNION ALL
    
    SELECT 
        f.id AS postId,
        f.title AS title,
        f.created_at AS createdAt,
        'freeboard' AS boardType
    FROM freeboards f
    JOIN users u ON f.writer = u.id
    WHERE u.username = #{username}
    
    ORDER BY createdAt DESC
  </select>

  <!-- 내가 쓴 댓글 -->
  <select id="getMyComments" parameterType="string" resultType="map">
    SELECT 
        c.id AS commentId,
        c.content AS content, 
        c.created_at AS createdAt,
        'gallery_comment' AS commentType
    FROM gallery_comments c  
    JOIN users u ON c.writer = u.id
    WHERE u.username = #{username}
    
    UNION ALL
    
    SELECT 
        fc.id AS commentId,
        fc.content AS content, 
        fc.created_at AS createdAt,
        'free_board_comment' AS commentType
    FROM freeboard_comments fc 
    JOIN users u ON fc.writer = u.id
    WHERE u.username = #{username}
    
    ORDER BY createdAt DESC
  </select>

  <!-- 좋아요 수 (예시: like 테이블이 있을 경우만 사용) -->
  <select id="getMyLikesCount" parameterType="string" resultType="int">
    SELECT 0 
</select>

</mapper>