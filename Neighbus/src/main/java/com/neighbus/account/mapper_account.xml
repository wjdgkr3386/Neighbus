<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.neighbus.account.AccountMapper">

	<!-- ★ 추가된 부분: 명시적인 ResultMap 정의 ★ 컬럼명과 DTO 필드명 간의 매핑 오류를 방지하고, 특히 user_uuid, 
		created_at과 같이 이름 규칙이 다른 필드의 매핑을 보장합니다. -->
	<resultMap id="AccountResultMap"
		type="com.neighbus.account.AccountDTO">
		<id property="id" column="id" />
		<result property="name" column="name" />
		<result property="username" column="username" />
		<result property="password" column="password" />
		<result property="city" column="city" />
		<result property="address" column="address" />
		<result property="phone" column="phone" />
		<result property="email" column="email" />
		<result property="image" column="image" />
		<result property="grade" column="grade" />
		<result property="birth" column="birth" />
		<result property="sex" column="sex" />
		<!-- DB: user_uuid -> DTO: userUuid 명시적 매핑 -->
		<result property="userUuid" column="user_uuid" />
		<result property="nickname" column="nickname" />
		<!-- DB: created_at -> DTO: createdAt 명시적 매핑 -->
		<result property="createdAt" column="created_at" />
	</resultMap>

	<insert id="insertSignup"
		parameterType="com.neighbus.account.AccountDTO">
		insert into users(
		name,
		username,
		password,
		city,
		address,
		phone,
		email,
		birth,
		sex,
		user_uuid,
		nickname
		) values(
		#{name},
		#{username},
		#{password},
		#{city},
		#{address},
		#{phone},
		#{email},
		DATE_FORMAT(#{birth}, '%y%m%d'),
		#{sex},
		#{userUuid},
		#{username}
		)
	</insert>

	<select id="getProvince" resultType="HashMap">
		select
		id as "id",
		province as
		"province"
		from
		provinces
		order by
		id asc;
	</select>

	<select id="getCity" resultType="HashMap">
		select
		id as "id",
		province as
		"province",
		city as "city"
		from
		cities
		order by
		id asc;
	</select>

	<select id="checkUsername" resultType="int"
		parameterType="com.neighbus.account.AccountDTO">
		select count(username) from users where username =
		#{username}
	</select>

	<select id="checkPhone" resultType="int"
		parameterType="com.neighbus.account.AccountDTO">
		select count(phone) from users where phone = #{phone}
	</select>

	<select id="checkEmail" resultType="int"
		parameterType="com.neighbus.account.AccountDTO">
		select count(email) from users where email = #{email}
	</select>

	<select id="getUser" resultMap="AccountResultMap"
		parameterType="String">
		select
		id,
		name,
		username,
		password,
		city,
		address,
		phone,
		email,
		image,
		grade,
		birth,
		sex,
		user_uuid,
		nickname,
		created_at
		from users
		where username=#{username}
	</select>

	<select id="getAllUser" resultType="HashMap" parameterType="int">select
		* from user where id = #{id};</select>




</mapper>